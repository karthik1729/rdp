var Bus, Channel, Component, Connection, DiscreteSystem, Entity, Event, Flow, NameSpace, S, Symbol, System, T, Token,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

NameSpace = (function() {
  function NameSpace(name, sep) {
    this.name = name;
    this.names = [];
    this.symbols = {};
    this.sep = sep || ".";
  }

  NameSpace.prototype.intern = function(symbol) {
    if (!this.symbols[symbol.name]) {
      this.names.push(symbol.name);
      this.symbols[symbol.name] = symbol;
    } else {
      this.symbols[symbol.name] = symbol;
    }
    return symbol.ns = this;
  };

  NameSpace.prototype.unintern = function(symbol) {
    var item;
    delete this.symbols[symbol.name];
    this.names = (function() {
      var _i, _len, _ref, _results;
      _ref = this.names;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        item = _ref[_i];
        if (item !== symbol.name) {
          _results.push(item);
        }
      }
      return _results;
    }).call(this);
    return symbol.ns = void 0;
  };

  NameSpace.prototype.getSymbol = function(name) {
    return this.symbols[name];
  };

  NameSpace.prototype.get = function(name) {
    return this.symbols[name].value;
  };

  NameSpace.prototype.allSymbols = function() {
    var name, symbols, _i, _len, _ref;
    symbols = [];
    _ref = this.names;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      name = _ref[_i];
      symbols.push(this.symbols[name]);
    }
    return symbols;
  };

  NameSpace.prototype.all = function() {
    var name, values, _i, _len, _ref;
    values = [];
    _ref = this.names;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      name = _ref[_i];
      values.push(this.symbols[name].value);
    }
    return values;
  };

  return NameSpace;

})();

Symbol = (function() {
  function Symbol(name, value, ns) {
    this.name = name;
    this.value = value;
    this.ns = ns;
  }

  Symbol.prototype.is = function(symbol, deep) {
    var equality, k, v, _i, _len;
    equality = {
      names: -1,
      namespaces: -1,
      attrs: -1
    };
    if (this.name === symbol.name) {
      equality.names = 1;
    }
    if (!this.ns) {
      equality.namespaces = 1;
    } else if (this.ns && this.ns.id === symbol.id) {
      equality.namespaces = 1;
    }
    equality.attrs = 1;
    for (v = _i = 0, _len = this.length; _i < _len; v = ++_i) {
      k = this[v];
      if (v !== symbol[k]) {
        equality.attrs = -1;
      }
    }
    if (deep) {
      if (equality.names === 1 && equality.namespaces === 1 && equality.attrs === 1) {
        return true;
      }
    } else {
      if (equality.names === 1 && equality.namespaces === 1) {
        return true;
      }
    }
    return false;
  };

  Symbol.prototype.toString = function() {
    if (this.ns) {
      return this.ns.id + this.ns.sep + this.name;
    } else {
      return this.name;
    }
  };

  return Symbol;

})();

S = function(name) {
  return new Symbol(name);
};

Token = (function(_super) {
  __extends(Token, _super);

  function Token(name) {
    this.name = name;
    this.value = this.name;
    if (typeof this.name === "string") {
      this[this.name] = true;
    }
  }

  return Token;

})(Symbol);

T = function(name) {
  return new Token(name);
};

Event = (function(_super) {
  __extends(Event, _super);

  function Event(name, payload) {
    this.name = name;
    this.payload = payload;
  }

  return Event;

})(Symbol);

Entity = (function(_super) {
  __extends(Entity, _super);

  function Entity(name, tags, value) {
    this.name = name;
    this.tags = tags;
    this.value = value;
  }

  return Entity;

})(Symbol);

Component = (function(_super) {
  __extends(Component, _super);

  function Component(name, attrs) {
    var k, v, _i, _len;
    this.name = name;
    for (v = _i = 0, _len = attrs.length; _i < _len; v = ++_i) {
      k = attrs[v];
      this[k] = v;
    }
  }

  return Component;

})(Symbol);

System = (function() {
  function System(flow) {
    this.flow = flow;
    this.handlers = null;
  }

  System.prototype.push = function(data, inlet) {};

  System.prototype.whenReady = function(handler, outlet) {
    if (!outlet) {
      if (this.handlers) {
        return this.handlers.push(handler);
      } else {
        console.log(this);
        return this.handlers = [handler];
      }
    } else {
      if (this.handlers) {
        return this.handlers.outlet.push(handler);
      } else {
        return this.handlers.outlet = [handler];
      }
    }
  };

  System.prototype.emit = function(data, outlet) {
    var handler, _i, _j, _len, _len1, _ref, _ref1, _results, _results1;
    if (!outlet) {
      _ref = this.handlers;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        handler = _ref[_i];
        _results.push(handler(data));
      }
      return _results;
    } else {
      _ref1 = this.handlers[outlet];
      _results1 = [];
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        handler = _ref1[_j];
        _results1.push(handler(data));
      }
      return _results1;
    }
  };

  return System;

})();

DiscreteSystem = (function() {
  function DiscreteSystem(flow, events) {
    this.flow = flow;
    this.events = events;
  }

  DiscreteSystem.prototype.raise = function(event) {};

  return DiscreteSystem;

})();

Channel = (function() {
  function Channel(inlet, outlet) {
    this.inlet = inlet;
    this.outlet = outlet;
  }

  return Channel;

})();

Connection = (function() {
  function Connection(source, sink, flow, channels) {
    this.flow = flow;
    this.channels = channels;
    this.source = this.flow.systems.get(source);
    this.sink = this.flow.systems.get(sink);
  }

  return Connection;

})();

Bus = (function() {
  function Bus() {
    this.entities = new NameSpace();
    this.discreteSystems = new NameSpace();
  }

  Bus.prototype.addDiscreteSystem = function(id, discreteSystemClass) {
    var discrete_sytem;
    discrete_sytem = new discreteSystemClass(this);
    id.value = discrete_sytem;
    return this.discreteSystems.intern(id);
  };

  Bus.prototype.createEntity = function(name, tags, value) {
    var entity;
    tags = tags || [];
    value = value || void 0;
    entity = new Entity(name, tags, value);
    this.entities.intern(entity);
    return entity;
  };

  Bus.prototype.getEntity = function(name, create) {
    if (this.entities.getSymbol(name)) {
      return this.entities.getSymbol(name);
    } else if (create) {
      return this.createEntity(name);
    } else {
      return null;
    }
  };

  Bus.prototype.getEntitiesByTags = function(tags) {
    var entities, entity, tag, _i, _j, _len, _len1, _ref;
    entities = [];
    _ref = this.entities.all();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      entity = _ref[_i];
      for (_j = 0, _len1 = tags.length; _j < _len1; _j++) {
        tag = tags[_j];
        if (__indexOf.call(entity.tags, tag) >= 0) {
          entities.push(entity);
        }
      }
    }
    return entities;
  };

  Bus.prototype.trigger = function(event) {
    var symbol, _i, _len, _ref, _ref1, _results;
    _ref = this.discreteSystems.allSymbols();
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      symbol = _ref[_i];
      if (_ref1 = event.name, __indexOf.call(symbol.events, _ref1) >= 0) {
        _results.push(symbol.value.raise(event));
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  return Bus;

})();

Flow = (function() {
  function Flow(id) {
    this.id = id;
    this.bus = new Bus;
    this.systems = new NameSpace("systems");
    this.connections = new NameSpace("systems.connections");
  }

  Flow.prototype.connect = function(id, source, sink, channels) {
    var channel, connection, _i, _len, _ref;
    connection = new Connection(source, sink, this, channels);
    if (connection.channels) {
      _ref = connection.channels;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        channel = _ref[_i];
        connection.source.prototype.whenReady.call(connection.source, (function(data) {
          return connection.sink.prototype.push.call(connection.sink, channel.inlet, data);
        }), channel.outlet);
      }
    } else {
      connection.source.prototype.whenReady.call(connection.source, (function(data) {
        return connection.sink.push(data);
      }));
    }
    id.value = connection;
    return this.connections.intern(id);
  };

  Flow.prototype.addSystem = function(id, systemClass) {
    var system;
    system = new systemClass(this);
    id.value = system;
    return this.systems.intern(id);
  };

  Flow.prototype.serialize = function() {
    var connection, system, xml, _i, _j, _len, _len1, _ref, _ref1;
    xml = "<xml>";
    xml += "<flow name='" + this.id.name + "'>";
    _ref = this.systems.all();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      system = _ref[_i];
      xml += "<system>";
      xml += "</system>";
    }
    _ref1 = this.connections.all();
    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
      connection = _ref1[_j];
      xml += "<connection>";
      xml += "</connection>";
    }
    xml = "</flow>";
    return xml = "</xml>";
  };

  Flow.prototype.log = function(x) {
    return console.log(x);
  };

  return Flow;

})();

exports.Symbol = Symbol;

exports.S = S;

exports.Token = Token;

exports.T = T;

exports.NameSpace = NameSpace;

exports.System = System;

exports.Channel = Channel;

exports.Connection = Connection;

exports.Event = Event;

exports.Entity = Entity;

exports.Bus = Bus;

exports.Flow = Flow;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLGdIQUFBO0VBQUE7O3VKQUFBOztBQUFBO0FBRWlCLEVBQUEsbUJBQUUsSUFBRixFQUFRLEdBQVIsR0FBQTtBQUNULElBRFUsSUFBQyxDQUFBLE9BQUEsSUFDWCxDQUFBO0FBQUEsSUFBQSxJQUFDLENBQUEsS0FBRCxHQUFTLEVBQVQsQ0FBQTtBQUFBLElBQ0EsSUFBQyxDQUFBLE9BQUQsR0FBVyxFQURYLENBQUE7QUFBQSxJQUVBLElBQUMsQ0FBQSxHQUFELEdBQU8sR0FBQSxJQUFPLEdBRmQsQ0FEUztFQUFBLENBQWI7O0FBQUEsc0JBS0EsTUFBQSxHQUFRLFNBQUMsTUFBRCxHQUFBO0FBQ0osSUFBQSxJQUFHLENBQUEsSUFBSyxDQUFBLE9BQVEsQ0FBQSxNQUFNLENBQUMsSUFBUCxDQUFoQjtBQUNJLE1BQUEsSUFBQyxDQUFBLEtBQUssQ0FBQyxJQUFQLENBQVksTUFBTSxDQUFDLElBQW5CLENBQUEsQ0FBQTtBQUFBLE1BQ0EsSUFBQyxDQUFBLE9BQVEsQ0FBQSxNQUFNLENBQUMsSUFBUCxDQUFULEdBQXdCLE1BRHhCLENBREo7S0FBQSxNQUFBO0FBSUksTUFBQSxJQUFDLENBQUEsT0FBUSxDQUFBLE1BQU0sQ0FBQyxJQUFQLENBQVQsR0FBd0IsTUFBeEIsQ0FKSjtLQUFBO1dBTUEsTUFBTSxDQUFDLEVBQVAsR0FBWSxLQVBSO0VBQUEsQ0FMUixDQUFBOztBQUFBLHNCQWNBLFFBQUEsR0FBVSxTQUFDLE1BQUQsR0FBQTtBQUNOLFFBQUEsSUFBQTtBQUFBLElBQUEsTUFBQSxDQUFBLElBQVEsQ0FBQSxPQUFRLENBQUEsTUFBTSxDQUFDLElBQVAsQ0FBaEIsQ0FBQTtBQUFBLElBQ0EsSUFBQyxDQUFBLEtBQUQ7O0FBQVU7QUFBQTtXQUFBLDJDQUFBO3dCQUFBO1lBQTZCLElBQUEsS0FBUSxNQUFNLENBQUM7QUFBNUMsd0JBQUEsS0FBQTtT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QUFBLE9BMlBPLENBQUMsQ0FBUixHQUFZLENBM1BaLENBQUE7O0FBQUEsT0E0UE8sQ0FBQyxLQUFSLEdBQWdCLEtBNVBoQixDQUFBOztBQUFBLE9BNlBPLENBQUMsQ0FBUixHQUFZLENBN1BaLENBQUE7O0FBQUEsT0E4UE8sQ0FBQyxTQUFSLEdBQW9CLFNBOVBwQixDQUFBOztBQUFBLE9BK1BPLENBQUMsTUFBUixHQUFpQixNQS9QakIsQ0FBQTs7QUFBQSxPQWdRTyxDQUFDLE9BQVIsR0FBa0IsT0FoUWxCLENBQUE7O0FBQUEsT0FpUU8sQ0FBQyxVQUFSLEdBQXFCLFVBalFyQixDQUFBOztBQUFBLE9Ba1FPLENBQUMsS0FBUixHQUFnQixLQWxRaEIsQ0FBQTs7QUFBQSxPQW1RTyxDQUFDLE1BQVIsR0FBaUIsTUFuUWpCLENBQUE7O0FBQUEsT0FvUU8sQ0FBQyxHQUFSLEdBQWMsR0FwUWQsQ0FBQTs7QUFBQSxPQXFRTyxDQUFDLElBQVIsR0FBZSxJQXJRZixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgTmFtZVNwYWNlXG5cbiAgICBjb25zdHJ1Y3RvcjogKEBuYW1lLCBzZXApIC0+XG4gICAgICAgIEBuYW1lcyA9IFtdXG4gICAgICAgIEBzeW1ib2xzID0ge31cbiAgICAgICAgQHNlcCA9IHNlcCB8fCBcIi5cIlxuXG4gICAgaW50ZXJuOiAoc3ltYm9sKSAtPlxuICAgICAgICBpZiBub3QgQHN5bWJvbHNbc3ltYm9sLm5hbWVdXG4gICAgICAgICAgICBAbmFtZXMucHVzaChzeW1ib2wubmFtZSlcbiAgICAgICAgICAgIEBzeW1ib2xzW3N5bWJvbC5uYW1lXSA9IHN5bWJvbFxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAc3ltYm9sc1tzeW1ib2wubmFtZV0gPSBzeW1ib2xcblxuICAgICAgICBzeW1ib2wubnMgPSB0aGlzXG5cbiAgICB1bmludGVybjogKHN5bWJvbCkgLT5cbiAgICAgICAgZGVsZXRlIEBzeW1ib2xzW3N5bWJvbC5uYW1lXVxuICAgICAgICBAbmFtZXMgPSAoaXRlbSBmb3IgaXRlbSBpbiBAbmFtZXMgd2hlbiBpdGVtICE9IHN5bWJvbC5uYW1lKVxuICAgICAgICBzeW1ib2wubnMgPSB1bmRlZmluZWRcblxuICAgIGdldFN5bWJvbDogKG5hbWUpIC0+XG4gICAgICAgIEBzeW1ib2xzW25hbWVdXG5cbiAgICBnZXQ6IChuYW1lKSAtPlxuICAgICAgICBAc3ltYm9sc1tuYW1lXS52YWx1ZVxuXG4gICAgYWxsU3ltYm9sczogKCkgLT5cbiAgICAgICAgc3ltYm9scyA9IFtdXG5cbiAgICAgICAgZm9yIG5hbWUgaW4gQG5hbWVzXG4gICAgICAgICAgICBzeW1ib2xzLnB1c2goQHN5bWJvbHNbbmFtZV0pXG5cbiAgICAgICAgcmV0dXJuIHN5bWJvbHNcblxuICAgIGFsbDogKCkgLT5cbiAgICAgICAgdmFsdWVzID0gW11cblxuICAgICAgICBmb3IgbmFtZSBpbiBAbmFtZXNcbiAgICAgICAgICAgIHZhbHVlcy5wdXNoKEBzeW1ib2xzW25hbWVdLnZhbHVlKVxuXG4gICAgICAgIHJldHVybiB2YWx1ZXNcblxuXG5jbGFzcyBTeW1ib2xcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUsIEB2YWx1ZSwgQG5zKSAtPlxuXG4gICAgaXM6IChzeW1ib2wsIGRlZXApIC0+XG4gICAgICAgZXF1YWxpdHkgPSB7XG4gICAgICAgICAgIG5hbWVzOiAtMVxuICAgICAgICAgICBuYW1lc3BhY2VzOiAtMVxuICAgICAgICAgICBhdHRyczogLTFcbiAgICAgICB9XG5cbiAgICAgICBpZiBAbmFtZSA9PSBzeW1ib2wubmFtZVxuICAgICAgICAgICBlcXVhbGl0eS5uYW1lcyA9IDFcblxuICAgICAgIGlmICFAbnNcbiAgICAgICAgICAgZXF1YWxpdHkubmFtZXNwYWNlcyA9IDFcbiAgICAgICBlbHNlIGlmIEBucyBhbmQgQG5zLmlkIGlzIHN5bWJvbC5pZFxuICAgICAgICAgICBlcXVhbGl0eS5uYW1lc3BhY2VzID0gMVxuXG4gICAgICAgZXF1YWxpdHkuYXR0cnMgPSAxXG5cbiAgICAgICBmb3Igayx2IGluIHRoaXNcbiAgICAgICAgICAgaWYgdiAhPSBzeW1ib2xba11cbiAgICAgICAgICAgICAgIGVxdWFsaXR5LmF0dHJzID0gLTFcblxuICAgICAgIGlmIGRlZXBcbiAgICAgICAgICAgaWYgZXF1YWxpdHkubmFtZXMgPT0gMSBhbmQgZXF1YWxpdHkubmFtZXNwYWNlcyA9PTEgYW5kIGVxdWFsaXR5LmF0dHJzID09IDFcbiAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgZWxzZVxuICAgICAgICAgICBpZiBlcXVhbGl0eS5uYW1lcyA9PSAxIGFuZCBlcXVhbGl0eS5uYW1lc3BhY2VzID09MVxuICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcblxuICAgICAgIHJldHVybiBmYWxzZVxuXG4gICAgdG9TdHJpbmc6IC0+XG4gICAgICAgaWYgQG5zXG4gICAgICAgICAgIHJldHVybiBAbnMuaWQgKyBAbnMuc2VwICsgQG5hbWVcbiAgICAgICAgZWxzZVxuICAgICAgICAgICByZXR1cm4gQG5hbWVcblxuUyA9IChuYW1lKSAtPlxuICAgIHJldHVybiBuZXcgU3ltYm9sKG5hbWUpXG5cblxuY2xhc3MgVG9rZW4gZXh0ZW5kcyBTeW1ib2xcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUpIC0+XG4gICAgICAgIEB2YWx1ZSA9IEBuYW1lXG4gICAgICAgIGlmIHR5cGVvZiBAbmFtZSBpcyBcInN0cmluZ1wiXG4gICAgICAgICAgICB0aGlzW0BuYW1lXSA9IHRydWVcblxuVCA9IChuYW1lKSAtPlxuICAgIHJldHVybiBuZXcgVG9rZW4obmFtZSlcblxuY2xhc3MgRXZlbnQgZXh0ZW5kcyBTeW1ib2xcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUsIEBwYXlsb2FkKSAtPlxuXG5jbGFzcyBFbnRpdHkgZXh0ZW5kcyBTeW1ib2xcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUsIEB0YWdzLCBAdmFsdWUpIC0+XG5cbmNsYXNzIENvbXBvbmVudCBleHRlbmRzIFN5bWJvbFxuXG4gICAgY29uc3RydWN0b3I6IChAbmFtZSwgYXR0cnMpIC0+XG4gICAgICAgIGZvciBrLCB2IGluIGF0dHJzXG4gICAgICAgICAgICB0aGlzW2tdID0gdlxuXG5jbGFzcyBTeXN0ZW1cblxuICAgIGNvbnN0cnVjdG9yOihAZmxvdykgLT5cbiAgICAgICAgQGhhbmRsZXJzID0gbnVsbFxuXG4gICAgcHVzaDogKGRhdGEsIGlubGV0KSAtPlxuXG4gICAgIyBqdXN0IGRhdGEgZm9yIHNpbmdsZSBpbmxldFxuICAgIHdoZW5SZWFkeTogKGhhbmRsZXIsIG91dGxldCkgLT5cblxuICAgICAgICBpZiBub3Qgb3V0bGV0XG4gICAgICAgICAgICBpZiBAaGFuZGxlcnNcbiAgICAgICAgICAgICAgIEBoYW5kbGVycy5wdXNoKGhhbmRsZXIpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzKVxuICAgICAgICAgICAgICAgQGhhbmRsZXJzID0gW2hhbmRsZXJdXG5cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgaWYgQGhhbmRsZXJzXG4gICAgICAgICAgICAgICAgQGhhbmRsZXJzLm91dGxldC5wdXNoKGhhbmRsZXIpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgQGhhbmRsZXJzLm91dGxldCA9IFtoYW5kbGVyXVxuXG5cblxuICAgIGVtaXQ6IChkYXRhLCBvdXRsZXQpIC0+XG4gICAgICAgIGlmIG5vdCBvdXRsZXRcbiAgICAgICAgICAgIGZvciBoYW5kbGVyIGluIEBoYW5kbGVyc1xuICAgICAgICAgICAgICAgIGhhbmRsZXIoZGF0YSlcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZm9yIGhhbmRsZXIgaW4gQGhhbmRsZXJzW291dGxldF1cbiAgICAgICAgICAgICAgICBoYW5kbGVyKGRhdGEpXG5cbmNsYXNzIERpc2NyZXRlU3lzdGVtXG5cbiAgICBjb25zdHJ1Y3RvcjogKEBmbG93LCBAZXZlbnRzKSAtPlxuXG4gICAgcmFpc2U6IChldmVudCkgLT5cblxuY2xhc3MgQ2hhbm5lbFxuXG4gICAgY29uc3RydWN0b3I6IChAaW5sZXQsIEBvdXRsZXQpIC0+XG5cbmNsYXNzIENvbm5lY3Rpb25cblxuICAgIGNvbnN0cnVjdG9yOiAoc291cmNlLCBzaW5rLCBAZmxvdywgQGNoYW5uZWxzKSAtPlxuICAgICAgICBAc291cmNlID0gQGZsb3cuc3lzdGVtcy5nZXQoc291cmNlKVxuICAgICAgICBAc2luayA9IEBmbG93LnN5c3RlbXMuZ2V0KHNpbmspXG5cblxuY2xhc3MgQnVzXG5cbiAgICBjb25zdHJ1Y3RvcjogLT5cbiAgICAgICAgQGVudGl0aWVzID0gbmV3IE5hbWVTcGFjZSgpXG4gICAgICAgIEBkaXNjcmV0ZVN5c3RlbXMgPSBuZXcgTmFtZVNwYWNlKClcblxuICAgIGFkZERpc2NyZXRlU3lzdGVtOiAoaWQsIGRpc2NyZXRlU3lzdGVtQ2xhc3MpIC0+XG4gICAgICAgIGRpc2NyZXRlX3N5dGVtID0gbmV3IGRpc2NyZXRlU3lzdGVtQ2xhc3ModGhpcylcbiAgICAgICAgaWQudmFsdWUgPSBkaXNjcmV0ZV9zeXRlbVxuICAgICAgICBAZGlzY3JldGVTeXN0ZW1zLmludGVybihpZClcblxuICAgIGNyZWF0ZUVudGl0eTogKG5hbWUsIHRhZ3MsIHZhbHVlKSAtPlxuICAgICAgICB0YWdzID0gdGFncyB8fCBbXVxuICAgICAgICB2YWx1ZSA9IHZhbHVlIHx8IHVuZGVmaW5lZFxuICAgICAgICBlbnRpdHkgPSBuZXcgRW50aXR5KG5hbWUsIHRhZ3MsIHZhbHVlKVxuICAgICAgICBAZW50aXRpZXMuaW50ZXJuKGVudGl0eSlcbiAgICAgICAgZW50aXR5XG5cbiAgICBnZXRFbnRpdHk6IChuYW1lLCBjcmVhdGUpIC0+XG4gICAgICAgIGlmIEBlbnRpdGllcy5nZXRTeW1ib2wobmFtZSlcbiAgICAgICAgICAgIHJldHVybiBAZW50aXRpZXMuZ2V0U3ltYm9sKG5hbWUpXG4gICAgICAgIGVsc2UgaWYgY3JlYXRlXG4gICAgICAgICAgICByZXR1cm4gQGNyZWF0ZUVudGl0eShuYW1lKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuXG4gICAgZ2V0RW50aXRpZXNCeVRhZ3M6ICh0YWdzKSAtPlxuICAgICAgICBlbnRpdGllcyA9IFtdXG4gICAgICAgIGZvciBlbnRpdHkgaW4gQGVudGl0aWVzLmFsbCgpXG4gICAgICAgICAgICBmb3IgdGFnIGluIHRhZ3NcbiAgICAgICAgICAgICAgICBpZiB0YWcgaW4gZW50aXR5LnRhZ3NcbiAgICAgICAgICAgICAgICAgICAgZW50aXRpZXMucHVzaCBlbnRpdHlcblxuICAgICAgICByZXR1cm4gZW50aXRpZXNcblxuXG4gICAgdHJpZ2dlcjogKGV2ZW50KSAtPlxuXG4gICAgICAgIGZvciBzeW1ib2wgaW4gQGRpc2NyZXRlU3lzdGVtcy5hbGxTeW1ib2xzKClcbiAgICAgICAgICAgIGlmIGV2ZW50Lm5hbWUgaW4gc3ltYm9sLmV2ZW50c1xuICAgICAgICAgICAgICAgIHN5bWJvbC52YWx1ZS5yYWlzZShldmVudClcblxuY2xhc3MgRmxvd1xuXG4gICAgY29uc3RydWN0b3I6IChAaWQpIC0+XG4gICAgICAgIEBidXMgPSBuZXcgQnVzXG4gICAgICAgIEBzeXN0ZW1zID0gbmV3IE5hbWVTcGFjZShcInN5c3RlbXNcIilcbiAgICAgICAgQGNvbm5lY3Rpb25zID0gbmV3IE5hbWVTcGFjZShcInN5c3RlbXMuY29ubmVjdGlvbnNcIilcblxuICAgIGNvbm5lY3Q6IChpZCwgc291cmNlLCBzaW5rLCBjaGFubmVscykgLT5cbiAgICAgICAgY29ubmVjdGlvbiA9IG5ldyBDb25uZWN0aW9uKHNvdXJjZSwgc2luaywgdGhpcywgY2hhbm5lbHMpXG5cbiAgICAgICAgaWYgY29ubmVjdGlvbi5jaGFubmVsc1xuICAgICAgICAgICAgZm9yIGNoYW5uZWwgaW4gY29ubmVjdGlvbi5jaGFubmVsc1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uc291cmNlLnByb3RvdHlwZS53aGVuUmVhZHkuY2FsbChjb25uZWN0aW9uLnNvdXJjZSwgKCgoZGF0YSkgLT5cbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi5zaW5rLnByb3RvdHlwZS5wdXNoLmNhbGwoY29ubmVjdGlvbi5zaW5rLCBjaGFubmVsLmlubGV0LCBkYXRhKSkpLFxuICAgICAgICAgICAgICAgICAgICBjaGFubmVsLm91dGxldClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgY29ubmVjdGlvbi5zb3VyY2UucHJvdG90eXBlLndoZW5SZWFkeS5jYWxsKGNvbm5lY3Rpb24uc291cmNlLCAoKGRhdGEpIC0+XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5zaW5rLnB1c2goZGF0YSkpKVxuXG4gICAgICAgIGlkLnZhbHVlID0gY29ubmVjdGlvblxuICAgICAgICBAY29ubmVjdGlvbnMuaW50ZXJuKGlkKVxuXG4gICAgYWRkU3lzdGVtOiAoaWQsIHN5c3RlbUNsYXNzKSAtPlxuICAgICAgICBzeXN0ZW0gPSBuZXcgc3lzdGVtQ2xhc3ModGhpcylcbiAgICAgICAgaWQudmFsdWUgPSBzeXN0ZW1cbiAgICAgICAgQHN5c3RlbXMuaW50ZXJuKGlkKVxuXG4gICAgc2VyaWFsaXplOiAtPlxuICAgICAgICB4bWwgPSBcIjx4bWw+XCJcbiAgICAgICAgeG1sICs9IFwiPGZsb3cgbmFtZT0nI3tAaWQubmFtZX0nPlwiXG5cbiAgICAgICAgZm9yIHN5c3RlbSBpbiBAc3lzdGVtcy5hbGwoKVxuICAgICAgICAgICAgeG1sICs9IFwiPHN5c3RlbT5cIlxuICAgICAgICAgICAgeG1sICs9IFwiPC9zeXN0ZW0+XCJcblxuICAgICAgICBmb3IgY29ubmVjdGlvbiBpbiBAY29ubmVjdGlvbnMuYWxsKClcbiAgICAgICAgICAgIHhtbCArPSBcIjxjb25uZWN0aW9uPlwiXG4gICAgICAgICAgICB4bWwgKz0gXCI8L2Nvbm5lY3Rpb24+XCJcblxuICAgICAgICB4bWwgPSBcIjwvZmxvdz5cIlxuICAgICAgICB4bWwgPSBcIjwveG1sPlwiXG5cbiAgICBsb2c6ICh4KSAtPlxuICAgICAgICBjb25zb2xlLmxvZyh4KVxuXG5cbmV4cG9ydHMuU3ltYm9sID0gU3ltYm9sXG5leHBvcnRzLlMgPSBTXG5leHBvcnRzLlRva2VuID0gVG9rZW5cbmV4cG9ydHMuVCA9IFRcbmV4cG9ydHMuTmFtZVNwYWNlID0gTmFtZVNwYWNlXG5leHBvcnRzLlN5c3RlbSA9IFN5c3RlbVxuZXhwb3J0cy5DaGFubmVsID0gQ2hhbm5lbFxuZXhwb3J0cy5Db25uZWN0aW9uID0gQ29ubmVjdGlvblxuZXhwb3J0cy5FdmVudCA9IEV2ZW50XG5leHBvcnRzLkVudGl0eSA9IEVudGl0eVxuZXhwb3J0cy5CdXMgPSBCdXNcbmV4cG9ydHMuRmxvdyA9IEZsb3dcblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9