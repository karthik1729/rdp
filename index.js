var Channel, Connection, DiscreteSystem, Entity, Flow, Message, NameSpace, StateBus, Symbol, System, Token,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

NameSpace = (function() {
  function NameSpace(name, sep) {
    this.name = name;
    this.names = [];
    this.symbols = {};
    this.sep = sep || ".";
  }

  NameSpace.prototype.intern = function(symbol) {
    if (!this.symbols[symbol.name]) {
      this.names.push(symbol.name);
      this.symbols[symbol.name] = symbol;
    } else {
      this.symbols[symbol.name] = symbol;
    }
    return symbol.ns = this;
  };

  NameSpace.prototype.unintern = function(symbol) {
    var item;
    delete this.symbols[symbol.name];
    this.names = (function() {
      var _i, _len, _ref, _results;
      _ref = this.names;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        item = _ref[_i];
        if (item !== symbol.name) {
          _results.push(item);
        }
      }
      return _results;
    }).call(this);
    return symbol.ns = void 0;
  };

  NameSpace.prototype.getSymbol = function(name) {
    return this.symbols[name];
  };

  NameSpace.prototype.get = function(name) {
    return this.symbols[name].value;
  };

  NameSpace.prototype.allSymbols = function() {
    var name, symbols, _i, _len, _ref;
    symbols = [];
    _ref = this.names;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      name = _ref[_i];
      symbols.push(this.symbols[name]);
    }
    return symbols;
  };

  NameSpace.prototype.all = function() {
    var name, values, _i, _len, _ref;
    values = [];
    _ref = this.names;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      name = _ref[_i];
      values.push(this.symbols[name].value);
    }
    return values;
  };

  return NameSpace;

})();

Symbol = (function() {
  function Symbol(name) {
    this.name = name;
    this.attrs = {};
    this.value = void 0;
    this.ns = void 0;
  }

  Symbol.prototype.is = function(symbol, deep) {
    var equality, k, v, _i, _len, _ref;
    equality = {
      names: -1,
      namespaces: -1,
      attrs: -1
    };
    if (this.name === symbol.name) {
      equality.names = 1;
    }
    if (!this.ns) {
      equality.namespaces = 1;
    } else if (this.ns && this.ns.id === symbol.id) {
      equality.namespaces = 1;
    }
    equality.attrs = 1;
    _ref = this.attrs;
    for (v = _i = 0, _len = _ref.length; _i < _len; v = ++_i) {
      k = _ref[v];
      if (v !== symbol.attrs.k) {
        equality.attrs = -1;
      }
    }
    if (deep) {
      if (equality.names === 1 && equality.namespaces === 1 && equality.attrs === 1) {
        return true;
      }
    } else {
      if (equality.names === 1 && equality.namespaces === 1) {
        return true;
      }
    }
    return false;
  };

  Symbol.prototype.toString = function() {
    if (this.ns) {
      return this.ns.id + this.ns.sep + this.name;
    } else {
      return this.name;
    }
  };

  return Symbol;

})();

Token = (function(_super) {
  __extends(Token, _super);

  function Token(name) {
    this.name = name;
    this.value = this.name;
    if (typeof this.name === "string") {
      this[this.name] = true;
    }
  }

  return Token;

})(Symbol);

System = (function() {
  function System(flow) {
    this.flow = flow;
    this.handlers = null;
  }

  System.prototype.push = function(data, inlet) {};

  System.prototype.whenReady = function(handler, outlet) {
    if (!outlet) {
      if (this.handlers) {
        return this.handlers.push(handler);
      } else {
        console.log(this);
        return this.handlers = [handler];
      }
    } else {
      if (this.handlers) {
        return this.handlers.outlet.push(handler);
      } else {
        return this.handlers.outlet = [handler];
      }
    }
  };

  System.prototype.emit = function(data, outlet) {
    var handler, _i, _j, _len, _len1, _ref, _ref1, _results, _results1;
    if (!outlet) {
      _ref = this.handlers;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        handler = _ref[_i];
        _results.push(handler(data));
      }
      return _results;
    } else {
      _ref1 = this.handlers[outlet];
      _results1 = [];
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        handler = _ref1[_j];
        _results1.push(handler(data));
      }
      return _results1;
    }
  };

  return System;

})();

DiscreteSystem = (function() {
  function DiscreteSystem(flow) {
    this.flow = flow;
  }

  DiscreteSystem.prototype.raise = function(message) {};

  return DiscreteSystem;

})();

Channel = (function() {
  function Channel(inlet, outlet) {
    this.inlet = inlet;
    this.outlet = outlet;
  }

  return Channel;

})();

Connection = (function() {
  function Connection(source, sink, flow, channels) {
    this.flow = flow;
    this.channels = channels;
    this.source = this.flow.systems.get(source);
    this.sink = this.flow.systems.get(sink);
  }

  return Connection;

})();

Message = (function() {
  function Message(event, payload) {
    this.event = event;
    this.payload = payload;
  }

  return Message;

})();

Entity = (function(_super) {
  __extends(Entity, _super);

  function Entity(name, tags, value) {
    this.name = name;
    this.tags = tags;
    this.value = value;
  }

  return Entity;

})(Symbol);

StateBus = (function() {
  function StateBus() {
    this.entities = new NameSpace();
    this.discreteSystems = new NameSpace();
  }

  StateBus.prototype.addDiscreteSystem = function(id, discreteSystemClass) {
    var discrete_sytem;
    discrete_sytem = new discreteSystemClass(this);
    id.value = discrete_sytem;
    return this.discreteSystems.intern(id);
  };

  StateBus.prototype.createEntity = function(name, tags, value) {
    var entity;
    tags = tags || [];
    value = value || void 0;
    entity = new Entity(name, tags, value);
    this.entities.intern(entity);
    return entity;
  };

  StateBus.prototype.getEntity = function(name, create) {
    if (this.entities.getSymbol(name)) {
      return this.entities.getSymbol(name);
    } else if (create) {
      return this.createEntity(name);
    } else {
      return null;
    }
  };

  StateBus.prototype.getEntitiesByTags = function(tags) {
    var entities, entity, tag, _i, _j, _len, _len1, _ref;
    entities = [];
    _ref = this.entities.all();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      entity = _ref[_i];
      for (_j = 0, _len1 = tags.length; _j < _len1; _j++) {
        tag = tags[_j];
        if (__indexOf.call(entity.tags, tag) >= 0) {
          entities.push(entity);
        }
      }
    }
    return entities;
  };

  StateBus.prototype.addDiscreteSystem = function(discrete_system, events) {
    var event, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = events.length; _i < _len; _i++) {
      event = events[_i];
      if (this.discreteSystems[event].systems === null) {
        _results.push(this.discreteSystems[event].systems = [discrete_system]);
      } else {
        _results.push(this.discreteSystems[event].systems.append(discrete_system));
      }
    }
    return _results;
  };

  StateBus.prototype.trigger = function(event, message) {
    var system, _i, _len, _ref, _results;
    _ref = this.discreteSystems[event];
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      system = _ref[_i];
      message = Message(event, message);
      _results.push(system.raise(message));
    }
    return _results;
  };

  return StateBus;

})();

Flow = (function() {
  function Flow(id) {
    this.id = id;
    this.bus = new StateBus;
    this.systems = new NameSpace("systems");
    this.connections = new NameSpace("systems.connections");
  }

  Flow.prototype.connect = function(id, source, sink, channels) {
    var channel, connection, _i, _len, _ref;
    connection = new Connection(source, sink, this, channels);
    if (connection.channels) {
      _ref = connection.channels;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        channel = _ref[_i];
        connection.source.prototype.whenReady.call(connection.source, (function(data) {
          return connection.sink.prototype.push.call(connection.sink, channel.inlet, data);
        }), channel.outlet);
      }
    } else {
      connection.source.prototype.whenReady.call(connection.source, (function(data) {
        return connection.sink.push(data);
      }));
    }
    id.value = connection;
    return this.connections.intern(id);
  };

  Flow.prototype.addSystem = function(id, systemClass) {
    var system;
    system = new systemClass(this);
    id.value = system;
    return this.systems.intern(id);
  };

  Flow.prototype.serialize = function() {
    var connection, system, xml, _i, _j, _len, _len1, _ref, _ref1;
    xml = "<xml>";
    xml += "<flow name='" + this.id.name + "'>";
    _ref = this.systems.all();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      system = _ref[_i];
      xml += "<system>";
      xml += "</system>";
    }
    _ref1 = this.connections.all();
    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
      connection = _ref1[_j];
      xml += "<connection>";
      xml += "</connection>";
    }
    xml = "</flow>";
    return xml = "</xml>";
  };

  Flow.prototype.log = function(x) {
    return console.log(x);
  };

  return Flow;

})();

exports.Symbol = Symbol;

exports.S = Symbol;

exports.Token = Token;

exports.T = Token;

exports.NameSpace = NameSpace;

exports.System = System;

exports.Channel = Channel;

exports.Connection = Connection;

exports.Message = Message;

exports.Entity = Entity;

exports.StateBus = StateBus;

exports.Flow = Flow;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLHNHQUFBO0VBQUE7O3VKQUFBOztBQUFBO0FBRWlCLEVBQUEsbUJBQUUsSUFBRixFQUFRLEdBQVIsR0FBQTtBQUNULElBRFUsSUFBQyxDQUFBLE9BQUEsSUFDWCxDQUFBO0FBQUEsSUFBQSxJQUFDLENBQUEsS0FBRCxHQUFTLEVBQVQsQ0FBQTtBQUFBLElBQ0EsSUFBQyxDQUFBLE9BQUQsR0FBVyxFQURYLENBQUE7QUFBQSxJQUVBLElBQUMsQ0FBQSxHQUFELEdBQU8sR0FBQSxJQUFPLEdBRmQsQ0FEUztFQUFBLENBQWI7O0FBQUEsc0JBS0EsTUFBQSxHQUFRLFNBQUMsTUFBRCxHQUFBO0FBQ0osSUFBQSxJQUFHLENBQUEsSUFBSyxDQUFBLE9BQVEsQ0FBQSxNQUFNLENBQUMsSUFBUCxDQUFoQjtBQUNJLE1BQUEsSUFBQyxDQUFBLEtBQUssQ0FBQyxJQUFQLENBQVksTUFBTSxDQUFDLElBQW5CLENBQUEsQ0FBQTtBQUFBLE1BQ0EsSUFBQyxDQUFBLE9BQVEsQ0FBQSxNQUFNLENBQUMsSUFBUCxDQUFULEdBQXdCLE1BRHhCLENBREo7S0FBQSxNQUFBO0FBSUksTUFBQSxJQUFDLENBQUEsT0FBUSxDQUFBLE1BQU0sQ0FBQyxJQUFQLENBQVQsR0FBd0IsTUFBeEIsQ0FKSjtLQUFBO1dBTUEsTUFBTSxDQUFDLEVBQVAsR0FBWSxLQVBSO0VBQUEsQ0FMUixDQUFBOztBQUFBLHNCQWNBLFFBQUEsR0FBVSxTQUFDLE1BQUQsR0FBQTtBQUNOLFFBQUEsSUFBQTtBQUFBLElBQUEsTUFBQSxDQUFBLElBQVEsQ0FBQSxPQUFRLENBQUEsTUFBTSxDQUFDLElBQVAsQ0FBaEIsQ0FBQTtBQUFBLElBQ0EsSUFBQyxDQUFBLEtBQUQ7O0FBQVU7QUFBQTtXQUFBLDJDQUFBO3dCQUFBO1lBQTZCLElBQUEsS0FBUSxNQUFNLENBQUM7QUFBNUMsd0JBQUEsS0FBQTtT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O0FBQUEsT0ErUE8sQ0FBQyxTQUFSLEdBQW9CLFNBL1BwQixDQUFBOztBQUFBLE9BZ1FPLENBQUMsTUFBUixHQUFpQixNQWhRakIsQ0FBQTs7QUFBQSxPQWlRTyxDQUFDLE9BQVIsR0FBa0IsT0FqUWxCLENBQUE7O0FBQUEsT0FrUU8sQ0FBQyxVQUFSLEdBQXFCLFVBbFFyQixDQUFBOztBQUFBLE9BbVFPLENBQUMsT0FBUixHQUFrQixPQW5RbEIsQ0FBQTs7QUFBQSxPQW9RTyxDQUFDLE1BQVIsR0FBaUIsTUFwUWpCLENBQUE7O0FBQUEsT0FxUU8sQ0FBQyxRQUFSLEdBQW1CLFFBclFuQixDQUFBOztBQUFBLE9Bc1FPLENBQUMsSUFBUixHQUFlLElBdFFmLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBOYW1lU3BhY2VcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUsIHNlcCkgLT5cbiAgICAgICAgQG5hbWVzID0gW11cbiAgICAgICAgQHN5bWJvbHMgPSB7fVxuICAgICAgICBAc2VwID0gc2VwIHx8IFwiLlwiXG5cbiAgICBpbnRlcm46IChzeW1ib2wpIC0+XG4gICAgICAgIGlmIG5vdCBAc3ltYm9sc1tzeW1ib2wubmFtZV1cbiAgICAgICAgICAgIEBuYW1lcy5wdXNoKHN5bWJvbC5uYW1lKVxuICAgICAgICAgICAgQHN5bWJvbHNbc3ltYm9sLm5hbWVdID0gc3ltYm9sXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBzeW1ib2xzW3N5bWJvbC5uYW1lXSA9IHN5bWJvbFxuXG4gICAgICAgIHN5bWJvbC5ucyA9IHRoaXNcblxuICAgIHVuaW50ZXJuOiAoc3ltYm9sKSAtPlxuICAgICAgICBkZWxldGUgQHN5bWJvbHNbc3ltYm9sLm5hbWVdXG4gICAgICAgIEBuYW1lcyA9IChpdGVtIGZvciBpdGVtIGluIEBuYW1lcyB3aGVuIGl0ZW0gIT0gc3ltYm9sLm5hbWUpXG4gICAgICAgIHN5bWJvbC5ucyA9IHVuZGVmaW5lZFxuXG4gICAgZ2V0U3ltYm9sOiAobmFtZSkgLT5cbiAgICAgICAgQHN5bWJvbHNbbmFtZV1cblxuICAgIGdldDogKG5hbWUpIC0+XG4gICAgICAgIEBzeW1ib2xzW25hbWVdLnZhbHVlXG5cbiAgICBhbGxTeW1ib2xzOiAoKSAtPlxuICAgICAgICBzeW1ib2xzID0gW11cblxuICAgICAgICBmb3IgbmFtZSBpbiBAbmFtZXNcbiAgICAgICAgICAgIHN5bWJvbHMucHVzaChAc3ltYm9sc1tuYW1lXSlcblxuICAgICAgICByZXR1cm4gc3ltYm9sc1xuXG4gICAgYWxsOiAoKSAtPlxuICAgICAgICB2YWx1ZXMgPSBbXVxuXG4gICAgICAgIGZvciBuYW1lIGluIEBuYW1lc1xuICAgICAgICAgICAgdmFsdWVzLnB1c2goQHN5bWJvbHNbbmFtZV0udmFsdWUpXG5cbiAgICAgICAgcmV0dXJuIHZhbHVlc1xuXG5cbmNsYXNzIFN5bWJvbFxuXG4gICAgY29uc3RydWN0b3I6IChAbmFtZSkgLT5cbiAgICAgICAgQGF0dHJzID0ge31cbiAgICAgICAgQHZhbHVlID0gdW5kZWZpbmVkXG4gICAgICAgIEBucyA9IHVuZGVmaW5lZFxuXG4gICAgaXM6IChzeW1ib2wsIGRlZXApIC0+XG4gICAgICAgZXF1YWxpdHkgPSB7XG4gICAgICAgICAgIG5hbWVzOiAtMVxuICAgICAgICAgICBuYW1lc3BhY2VzOiAtMVxuICAgICAgICAgICBhdHRyczogLTFcbiAgICAgICB9XG5cbiAgICAgICBpZiBAbmFtZSA9PSBzeW1ib2wubmFtZVxuICAgICAgICAgICBlcXVhbGl0eS5uYW1lcyA9IDFcblxuICAgICAgIGlmICFAbnNcbiAgICAgICAgICAgZXF1YWxpdHkubmFtZXNwYWNlcyA9IDFcbiAgICAgICBlbHNlIGlmIEBucyBhbmQgQG5zLmlkIGlzIHN5bWJvbC5pZFxuICAgICAgICAgICBlcXVhbGl0eS5uYW1lc3BhY2VzID0gMVxuXG4gICAgICAgZXF1YWxpdHkuYXR0cnMgPSAxXG5cbiAgICAgICBmb3Igayx2IGluIEBhdHRyc1xuICAgICAgICAgICBpZiB2ICE9IHN5bWJvbC5hdHRycy5rXG4gICAgICAgICAgICAgICBlcXVhbGl0eS5hdHRycyA9IC0xXG5cbiAgICAgICBpZiBkZWVwXG4gICAgICAgICAgIGlmIGVxdWFsaXR5Lm5hbWVzID09IDEgYW5kIGVxdWFsaXR5Lm5hbWVzcGFjZXMgPT0xIGFuZCBlcXVhbGl0eS5hdHRycyA9PSAxXG4gICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgIGVsc2VcbiAgICAgICAgICAgaWYgZXF1YWxpdHkubmFtZXMgPT0gMSBhbmQgZXF1YWxpdHkubmFtZXNwYWNlcyA9PTFcbiAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG5cbiAgICAgICByZXR1cm4gZmFsc2VcblxuICAgIHRvU3RyaW5nOiAtPlxuICAgICAgIGlmIEBuc1xuICAgICAgICAgICByZXR1cm4gQG5zLmlkICsgQG5zLnNlcCArIEBuYW1lXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgcmV0dXJuIEBuYW1lXG5cbmNsYXNzIFRva2VuIGV4dGVuZHMgU3ltYm9sXG5cbiAgICBjb25zdHJ1Y3RvcjogKEBuYW1lKSAtPlxuICAgICAgICBAdmFsdWUgPSBAbmFtZVxuICAgICAgICBpZiB0eXBlb2YgQG5hbWUgaXMgXCJzdHJpbmdcIlxuICAgICAgICAgICAgdGhpc1tAbmFtZV0gPSB0cnVlXG5cbmNsYXNzIFN5c3RlbVxuXG4gICAgY29uc3RydWN0b3I6KEBmbG93KSAtPlxuICAgICAgICBAaGFuZGxlcnMgPSBudWxsXG5cbiAgICBwdXNoOiAoZGF0YSwgaW5sZXQpIC0+XG5cbiAgICAjIGp1c3QgZGF0YSBmb3Igc2luZ2xlIGlubGV0XG4gICAgd2hlblJlYWR5OiAoaGFuZGxlciwgb3V0bGV0KSAtPlxuXG4gICAgICAgIGlmIG5vdCBvdXRsZXRcbiAgICAgICAgICAgIGlmIEBoYW5kbGVyc1xuICAgICAgICAgICAgICAgQGhhbmRsZXJzLnB1c2goaGFuZGxlcilcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMpXG4gICAgICAgICAgICAgICBAaGFuZGxlcnMgPSBbaGFuZGxlcl1cblxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpZiBAaGFuZGxlcnNcbiAgICAgICAgICAgICAgICBAaGFuZGxlcnMub3V0bGV0LnB1c2goaGFuZGxlcilcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBAaGFuZGxlcnMub3V0bGV0ID0gW2hhbmRsZXJdXG5cblxuXG4gICAgZW1pdDogKGRhdGEsIG91dGxldCkgLT5cbiAgICAgICAgIyAgICAgICAgY29uc29sZS5sb2coZGF0YSlcbiAgICAgICAgIyBjb25zb2xlLmxvZyh0aGlzKVxuICAgICAgICBpZiBub3Qgb3V0bGV0XG4gICAgICAgICAgICBmb3IgaGFuZGxlciBpbiBAaGFuZGxlcnNcbiAgICAgICAgICAgICAgICBoYW5kbGVyKGRhdGEpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGZvciBoYW5kbGVyIGluIEBoYW5kbGVyc1tvdXRsZXRdXG4gICAgICAgICAgICAgICAgaGFuZGxlcihkYXRhKVxuXG5jbGFzcyBEaXNjcmV0ZVN5c3RlbVxuXG4gICAgY29uc3RydWN0b3I6IChAZmxvdykgLT5cblxuICAgIHJhaXNlOiAobWVzc2FnZSkgLT5cblxuY2xhc3MgQ2hhbm5lbFxuXG4gICAgY29uc3RydWN0b3I6IChAaW5sZXQsIEBvdXRsZXQpIC0+XG5cbmNsYXNzIENvbm5lY3Rpb25cblxuICAgIGNvbnN0cnVjdG9yOiAoc291cmNlLCBzaW5rLCBAZmxvdywgQGNoYW5uZWxzKSAtPlxuICAgICAgICBAc291cmNlID0gQGZsb3cuc3lzdGVtcy5nZXQoc291cmNlKVxuICAgICAgICBAc2luayA9IEBmbG93LnN5c3RlbXMuZ2V0KHNpbmspXG5cbmNsYXNzIE1lc3NhZ2VcblxuICAgIGNvbnN0cnVjdG9yOiAoQGV2ZW50LCBAcGF5bG9hZCkgLT5cblxuXG5jbGFzcyBFbnRpdHkgZXh0ZW5kcyBTeW1ib2xcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUsIEB0YWdzLCBAdmFsdWUpIC0+XG5cblxuY2xhc3MgU3RhdGVCdXNcblxuICAgIGNvbnN0cnVjdG9yOiAtPlxuICAgICAgICBAZW50aXRpZXMgPSBuZXcgTmFtZVNwYWNlKClcbiAgICAgICAgQGRpc2NyZXRlU3lzdGVtcyA9IG5ldyBOYW1lU3BhY2UoKVxuXG4gICAgYWRkRGlzY3JldGVTeXN0ZW06IChpZCwgZGlzY3JldGVTeXN0ZW1DbGFzcykgLT5cbiAgICAgICAgZGlzY3JldGVfc3l0ZW0gPSBuZXcgZGlzY3JldGVTeXN0ZW1DbGFzcyh0aGlzKVxuICAgICAgICBpZC52YWx1ZSA9IGRpc2NyZXRlX3N5dGVtXG4gICAgICAgIEBkaXNjcmV0ZVN5c3RlbXMuaW50ZXJuKGlkKVxuXG4gICAgY3JlYXRlRW50aXR5OiAobmFtZSwgdGFncywgdmFsdWUpIC0+XG4gICAgICAgIHRhZ3MgPSB0YWdzIHx8IFtdXG4gICAgICAgIHZhbHVlID0gdmFsdWUgfHwgdW5kZWZpbmVkXG4gICAgICAgIGVudGl0eSA9IG5ldyBFbnRpdHkobmFtZSwgdGFncywgdmFsdWUpXG4gICAgICAgIEBlbnRpdGllcy5pbnRlcm4oZW50aXR5KVxuICAgICAgICBlbnRpdHlcblxuICAgIGdldEVudGl0eTogKG5hbWUsIGNyZWF0ZSkgLT5cbiAgICAgICAgaWYgQGVudGl0aWVzLmdldFN5bWJvbChuYW1lKVxuICAgICAgICAgICAgcmV0dXJuIEBlbnRpdGllcy5nZXRTeW1ib2wobmFtZSlcbiAgICAgICAgZWxzZSBpZiBjcmVhdGVcbiAgICAgICAgICAgIHJldHVybiBAY3JlYXRlRW50aXR5KG5hbWUpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsXG5cbiAgICBnZXRFbnRpdGllc0J5VGFnczogKHRhZ3MpIC0+XG4gICAgICAgIGVudGl0aWVzID0gW11cbiAgICAgICAgZm9yIGVudGl0eSBpbiBAZW50aXRpZXMuYWxsKClcbiAgICAgICAgICAgIGZvciB0YWcgaW4gdGFnc1xuICAgICAgICAgICAgICAgIGlmIHRhZyBpbiBlbnRpdHkudGFnc1xuICAgICAgICAgICAgICAgICAgICBlbnRpdGllcy5wdXNoIGVudGl0eVxuXG4gICAgICAgIHJldHVybiBlbnRpdGllc1xuXG4gICAgYWRkRGlzY3JldGVTeXN0ZW06IChkaXNjcmV0ZV9zeXN0ZW0sIGV2ZW50cykgLT5cblxuICAgICAgICBmb3IgZXZlbnQgaW4gZXZlbnRzXG5cbiAgICAgICAgICAgIGlmIEBkaXNjcmV0ZVN5c3RlbXNbZXZlbnRdLnN5c3RlbXMgaXMgbnVsbFxuICAgICAgICAgICAgICAgIEBkaXNjcmV0ZVN5c3RlbXNbZXZlbnRdLnN5c3RlbXMgPSBbZGlzY3JldGVfc3lzdGVtXVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIEBkaXNjcmV0ZVN5c3RlbXNbZXZlbnRdLnN5c3RlbXMuYXBwZW5kKGRpc2NyZXRlX3N5c3RlbSlcblxuICAgIHRyaWdnZXI6IChldmVudCwgbWVzc2FnZSkgLT5cblxuICAgICAgICBmb3Igc3lzdGVtIGluIEBkaXNjcmV0ZVN5c3RlbXNbZXZlbnRdXG4gICAgICAgICAgICBtZXNzYWdlID0gTWVzc2FnZShldmVudCwgbWVzc2FnZSlcbiAgICAgICAgICAgIHN5c3RlbS5yYWlzZShtZXNzYWdlKVxuXG5jbGFzcyBGbG93XG5cbiAgICBjb25zdHJ1Y3RvcjogKEBpZCkgLT5cbiAgICAgICAgQGJ1cyA9IG5ldyBTdGF0ZUJ1c1xuICAgICAgICBAc3lzdGVtcyA9IG5ldyBOYW1lU3BhY2UoXCJzeXN0ZW1zXCIpXG4gICAgICAgIEBjb25uZWN0aW9ucyA9IG5ldyBOYW1lU3BhY2UoXCJzeXN0ZW1zLmNvbm5lY3Rpb25zXCIpXG5cbiAgICBjb25uZWN0OiAoaWQsIHNvdXJjZSwgc2luaywgY2hhbm5lbHMpIC0+XG4gICAgICAgIGNvbm5lY3Rpb24gPSBuZXcgQ29ubmVjdGlvbihzb3VyY2UsIHNpbmssIHRoaXMsIGNoYW5uZWxzKVxuXG4gICAgICAgIGlmIGNvbm5lY3Rpb24uY2hhbm5lbHNcbiAgICAgICAgICAgIGZvciBjaGFubmVsIGluIGNvbm5lY3Rpb24uY2hhbm5lbHNcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnNvdXJjZS5wcm90b3R5cGUud2hlblJlYWR5LmNhbGwoY29ubmVjdGlvbi5zb3VyY2UsICgoKGRhdGEpIC0+XG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uc2luay5wcm90b3R5cGUucHVzaC5jYWxsKGNvbm5lY3Rpb24uc2luaywgY2hhbm5lbC5pbmxldCwgZGF0YSkpKSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbC5vdXRsZXQpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGNvbm5lY3Rpb24uc291cmNlLnByb3RvdHlwZS53aGVuUmVhZHkuY2FsbChjb25uZWN0aW9uLnNvdXJjZSwgKChkYXRhKSAtPlxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uc2luay5wdXNoKGRhdGEpKSlcblxuICAgICAgICBpZC52YWx1ZSA9IGNvbm5lY3Rpb25cbiAgICAgICAgQGNvbm5lY3Rpb25zLmludGVybihpZClcblxuICAgIGFkZFN5c3RlbTogKGlkLCBzeXN0ZW1DbGFzcykgLT5cbiAgICAgICAgc3lzdGVtID0gbmV3IHN5c3RlbUNsYXNzKHRoaXMpXG4gICAgICAgIGlkLnZhbHVlID0gc3lzdGVtXG4gICAgICAgIEBzeXN0ZW1zLmludGVybihpZClcblxuICAgIHNlcmlhbGl6ZTogLT5cbiAgICAgICAgeG1sID0gXCI8eG1sPlwiXG4gICAgICAgIHhtbCArPSBcIjxmbG93IG5hbWU9JyN7QGlkLm5hbWV9Jz5cIlxuXG4gICAgICAgIGZvciBzeXN0ZW0gaW4gQHN5c3RlbXMuYWxsKClcbiAgICAgICAgICAgIHhtbCArPSBcIjxzeXN0ZW0+XCJcbiAgICAgICAgICAgIHhtbCArPSBcIjwvc3lzdGVtPlwiXG5cbiAgICAgICAgZm9yIGNvbm5lY3Rpb24gaW4gQGNvbm5lY3Rpb25zLmFsbCgpXG4gICAgICAgICAgICB4bWwgKz0gXCI8Y29ubmVjdGlvbj5cIlxuICAgICAgICAgICAgeG1sICs9IFwiPC9jb25uZWN0aW9uPlwiXG5cbiAgICAgICAgeG1sID0gXCI8L2Zsb3c+XCJcbiAgICAgICAgeG1sID0gXCI8L3htbD5cIlxuXG4gICAgbG9nOiAoeCkgLT5cbiAgICAgICAgY29uc29sZS5sb2coeClcblxuXG5leHBvcnRzLlN5bWJvbCA9IFN5bWJvbFxuZXhwb3J0cy5TID0gU3ltYm9sXG5leHBvcnRzLlRva2VuID0gVG9rZW5cbmV4cG9ydHMuVCA9IFRva2VuXG5leHBvcnRzLk5hbWVTcGFjZSA9IE5hbWVTcGFjZVxuZXhwb3J0cy5TeXN0ZW0gPSBTeXN0ZW1cbmV4cG9ydHMuQ2hhbm5lbCA9IENoYW5uZWxcbmV4cG9ydHMuQ29ubmVjdGlvbiA9IENvbm5lY3Rpb25cbmV4cG9ydHMuTWVzc2FnZSA9IE1lc3NhZ2VcbmV4cG9ydHMuRW50aXR5ID0gRW50aXR5XG5leHBvcnRzLlN0YXRlQnVzID0gU3RhdGVCdXNcbmV4cG9ydHMuRmxvdyA9IEZsb3dcblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9