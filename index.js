var Bus, Channel, Component, Connection, DiscreteSystem, Entity, Event, Flow, GO, NameSpace, S, Symbol, System, T, Token, uuid,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

uuid = require("node-uuid");

NameSpace = (function() {
  function NameSpace(name, sep) {
    this.name = name;
    this.names = [];
    this.symbols = {};
    this.sep = sep || ".";
  }

  NameSpace.prototype.intern = function(symbol) {
    if (!this.symbols[symbol.name]) {
      this.names.push(symbol.name);
      this.symbols[symbol.name] = symbol;
    } else {
      this.symbols[symbol.name] = symbol;
    }
    return symbol.ns = this;
  };

  NameSpace.prototype.unintern = function(symbol) {
    var item;
    delete this.symbols[symbol.name];
    this.names = (function() {
      var _i, _len, _ref, _results;
      _ref = this.names;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        item = _ref[_i];
        if (item !== symbol.name) {
          _results.push(item);
        }
      }
      return _results;
    }).call(this);
    return symbol.ns = void 0;
  };

  NameSpace.prototype.getSymbol = function(name) {
    return this.symbols[name];
  };

  NameSpace.prototype.get = function(name) {
    return this.symbols[name].value;
  };

  NameSpace.prototype.allSymbols = function() {
    var name, symbols, _i, _len, _ref;
    symbols = [];
    _ref = this.names;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      name = _ref[_i];
      symbols.push(this.symbols[name]);
    }
    return symbols;
  };

  NameSpace.prototype.all = function() {
    var name, values, _i, _len, _ref;
    values = [];
    _ref = this.names;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      name = _ref[_i];
      values.push(this.symbols[name].value);
    }
    return values;
  };

  return NameSpace;

})();

Symbol = (function() {
  function Symbol(name, value, ns) {
    this.name = name;
    this.value = value;
    this.ns = ns;
    this.uuid = uuid.v4();
  }

  Symbol.prototype.is = function(symbol, deep) {
    var equality, k, v, _i, _len;
    equality = {
      names: -1,
      namespaces: -1,
      attrs: -1
    };
    if (this.name === symbol.name) {
      equality.names = 1;
    }
    if (!this.ns) {
      equality.namespaces = 1;
    } else if (this.ns && this.ns.id === symbol.id) {
      equality.namespaces = 1;
    }
    equality.attrs = 1;
    for (v = _i = 0, _len = this.length; _i < _len; v = ++_i) {
      k = this[v];
      if (v !== symbol[k]) {
        equality.attrs = -1;
      }
    }
    if (deep) {
      if (equality.names === 1 && equality.namespaces === 1 && equality.attrs === 1) {
        return true;
      }
    } else {
      if (equality.names === 1 && equality.namespaces === 1) {
        return true;
      }
    }
    return false;
  };

  Symbol.prototype.toString = function() {
    if (this.ns) {
      return this.ns.id + this.ns.sep + this.name;
    } else {
      return this.name;
    }
  };

  return Symbol;

})();

S = function(name) {
  return new Symbol(name);
};

Token = (function(_super) {
  __extends(Token, _super);

  function Token(name) {
    this.name = name;
    this.append(this.name);
  }

  Token.prototype.append = function(name) {
    this.name = name;
    this.value = this.name;
    if (typeof this.name === "string") {
      return this[this.name] = true;
    }
  };

  return Token;

})(Symbol);

T = function(name) {
  return new Token(name);
};

Event = (function(_super) {
  __extends(Event, _super);

  function Event(name, payload) {
    this.name = name;
    this.payload = payload;
  }

  return Event;

})(Symbol);

Entity = (function(_super) {
  __extends(Entity, _super);

  function Entity(name, tags, value) {
    this.name = name;
    this.tags = tags;
    this.value = value;
  }

  return Entity;

})(Symbol);

Component = (function(_super) {
  __extends(Component, _super);

  function Component(name, attrs) {
    var k, v, _i, _len;
    this.name = name;
    for (v = _i = 0, _len = attrs.length; _i < _len; v = ++_i) {
      k = attrs[v];
      this[k] = v;
    }
  }

  return Component;

})(Symbol);

System = (function() {
  function System(flow, options) {
    this.flow = flow;
    this.options = options;
    this.handlers = null;
  }

  System.prototype.push = function(data, inlet) {};

  System.prototype.whenReady = function(handler, outlet) {
    if (!outlet) {
      if (this.handlers) {
        return this.handlers.push(handler);
      } else {
        return this.handlers = [handler];
      }
    } else {
      if (this.handlers) {
        return this.handlers.outlet.push(handler);
      } else {
        return this.handlers.outlet = [handler];
      }
    }
  };

  System.prototype.emit = function(data, outlet) {
    var handler, _i, _j, _len, _len1, _ref, _ref1, _results, _results1;
    if (!outlet) {
      _ref = this.handlers;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        handler = _ref[_i];
        _results.push(handler(data));
      }
      return _results;
    } else {
      _ref1 = this.handlers[outlet];
      _results1 = [];
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        handler = _ref1[_j];
        _results1.push(handler(data));
      }
      return _results1;
    }
  };

  return System;

})();

DiscreteSystem = (function() {
  function DiscreteSystem(flow, events) {
    this.flow = flow;
    this.events = events;
  }

  DiscreteSystem.prototype.raise = function(event) {};

  return DiscreteSystem;

})();

Channel = (function() {
  function Channel(inlet, outlet) {
    this.inlet = inlet;
    this.outlet = outlet;
  }

  return Channel;

})();

Connection = (function() {
  function Connection(source, sink, flow, channels) {
    this.flow = flow;
    this.channels = channels;
    this.source = this.flow.systems.get(source);
    this.sink = this.flow.systems.get(sink);
  }

  return Connection;

})();

Bus = (function() {
  function Bus() {
    this.entities = new NameSpace("bus.entities");
    this.discreteSystems = new NameSpace("bus.systems");
  }

  Bus.prototype.addDiscreteSystem = function(id, discreteSystemClass) {
    var discrete_sytem;
    discrete_sytem = new discreteSystemClass(this);
    id.value = discrete_sytem;
    return this.discreteSystems.intern(id);
  };

  Bus.prototype.createEntity = function(name, tags, value) {
    var entity;
    tags = tags || [];
    value = value || void 0;
    entity = new Entity(name, tags, value);
    this.entities.intern(entity);
    return entity;
  };

  Bus.prototype.getEntity = function(name, value) {
    if (this.entities.getSymbol(name)) {
      return this.entities.getSymbol(name);
    } else if (value) {
      return this.createEntity(name, value);
    } else {
      return null;
    }
  };

  Bus.prototype.getEntitiesByTags = function(tags) {
    var entities, entity, tag, _i, _j, _len, _len1, _ref;
    entities = [];
    _ref = this.entities.allSymbols();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      entity = _ref[_i];
      for (_j = 0, _len1 = tags.length; _j < _len1; _j++) {
        tag = tags[_j];
        if (__indexOf.call(entity.tags, tag) >= 0) {
          entities.push(entity);
        }
      }
    }
    return entities;
  };

  Bus.prototype.trigger = function(event) {
    var symbol, _i, _len, _ref, _ref1, _results;
    _ref = this.discreteSystems.allSymbols();
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      symbol = _ref[_i];
      if (_ref1 = event.name, __indexOf.call(symbol.events, _ref1) >= 0) {
        _results.push(symbol.value.raise(event));
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  return Bus;

})();

Flow = (function() {
  function Flow(id) {
    this.id = id;
    this.bus = new Bus;
    this.systems = new NameSpace("systems");
    this.connections = new NameSpace("systems.connections");
    this.views = new NameSpace("systems.views");
  }

  Flow.prototype.connect = function(id, source, sink, channels) {
    var channel, connection, _i, _len, _ref;
    connection = new Connection(source, sink, this, channels);
    if (connection.channels) {
      _ref = connection.channels;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        channel = _ref[_i];
        connection.source.whenReady((function(data) {
          return connection.sink.push.call(connection.sink, channel.inlet, data);
        }), channel.outlet);
      }
    } else {
      connection.source.whenReady((function(data) {
        return connection.sink.push(data);
      }));
    }
    if (!id.name) {
      id.name = "" + source + "-" + sink;
    }
    id.value = connection;
    return this.connections.intern(id);
  };

  Flow.prototype.addSystem = function(id, systemClass, options) {
    var system;
    system = new systemClass(this, options);
    id.value = system;
    return this.systems.intern(id);
  };

  Flow.prototype.addView = function(id, viewClass, options) {
    var view;
    view = new viewClass(this, options);
    id.value = view;
    return this.views.intern(id);
  };

  return Flow;

})();

GO = (function() {
  function GO(flow, options) {
    this.flow = flow;
  }

  GO.prototype.show = function(data) {};

  GO.prototype.interact = function(data) {};

  return GO;

})();

exports.Symbol = Symbol;

exports.S = S;

exports.Token = Token;

exports.T = T;

exports.NameSpace = NameSpace;

exports.System = System;

exports.DiscreteSystem = DiscreteSystem;

exports.Channel = Channel;

exports.Connection = Connection;

exports.Event = Event;

exports.Entity = Entity;

exports.Bus = Bus;

exports.Flow = Flow;

exports.GO = GO;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLDBIQUFBO0VBQUE7O3VKQUFBOztBQUFBLElBQUEsR0FBTyxPQUFBLENBQVEsV0FBUixDQUFQLENBQUE7O0FBQUE7QUFJaUIsRUFBQSxtQkFBRSxJQUFGLEVBQVEsR0FBUixHQUFBO0FBQ1QsSUFEVSxJQUFDLENBQUEsT0FBQSxJQUNYLENBQUE7QUFBQSxJQUFBLElBQUMsQ0FBQSxLQUFELEdBQVMsRUFBVCxDQUFBO0FBQUEsSUFDQSxJQUFDLENBQUEsT0FBRCxHQUFXLEVBRFgsQ0FBQTtBQUFBLElBRUEsSUFBQyxDQUFBLEdBQUQsR0FBTyxHQUFBLElBQU8sR0FGZCxDQURTO0VBQUEsQ0FBYjs7QUFBQSxzQkFLQSxNQUFBLEdBQVEsU0FBQyxNQUFELEdBQUE7QUFDSixJQUFBLElBQUcsQ0FBQSxJQUFLLENBQUEsT0FBUSxDQUFBLE1BQU0sQ0FBQyxJQUFQLENBQWhCO0FBQ0ksTUFBQSxJQUFDLENBQUEsS0FBSyxDQUFDLElBQVAsQ0FBWSxNQUFNLENBQUMsSUFBbkIsQ0FBQSxDQUFBO0FBQUEsTUFDQSxJQUFDLENBQUEsT0FBUSxDQUFBLE1BQU0sQ0FBQyxJQUFQLENBQVQsR0FBd0IsTUFEeEIsQ0FESjtLQUFBLE1BQUE7QUFJSSxNQUFBLElBQUMsQ0FBQSxPQUFRLENBQUEsTUFBTSxDQUFDLElBQVAsQ0FBVCxHQUF3QixNQUF4QixDQUpKO0tBQUE7V0FNQSxNQUFNLENBQUMsRUFBUCxHQUFZLEtBUFI7RUFBQSxDQUxSLENBQUE7O0FBQUEsc0JBY0EsUUFBQSxHQUFVLFNBQUMsTUFBRCxHQUFBO0FBQ04sUUFBQSxJQUFBO0FBQUEsSUFBQSxNQUFBLENBQUEsSUFBUSxDQUFBLE9BQVEsQ0FBQSxNQUFNLENBQUMsSUFBUCxDQUFoQixDQUFBO0FBQUEsSUFDQSxJQUFDLENBQUEsS0FBRDs7QUFBVTtBQUFBO1dBQUEsMkNBQUE7d0JBQUE7WUFB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LE1BQVAsQ0FBYyxFQUFkLEVBSEs7RUFBQSxDQTdCVCxDQUFBOztjQUFBOztJQXBOSixDQUFBOztBQUFBO0FBeVBpQixFQUFBLFlBQUUsSUFBRixFQUFRLE9BQVIsR0FBQTtBQUFrQixJQUFqQixJQUFDLENBQUEsT0FBQSxJQUFnQixDQUFsQjtFQUFBLENBQWI7O0FBQUEsZUFDQSxJQUFBLEdBQU0sU0FBQyxJQUFELEdBQUEsQ0FETixDQUFBOztBQUFBLGVBRUEsUUFBQSxHQUFVLFNBQUMsSUFBRCxHQUFBLENBRlYsQ0FBQTs7WUFBQTs7SUF6UEosQ0FBQTs7QUFBQSxPQTZQTyxDQUFDLE1BQVIsR0FBaUIsTUE3UGpCLENBQUE7O0FBQUEsT0E4UE8sQ0FBQyxDQUFSLEdBQVksQ0E5UFosQ0FBQTs7QUFBQSxPQStQTyxDQUFDLEtBQVIsR0FBZ0IsS0EvUGhCLENBQUE7O0FBQUEsT0FnUU8sQ0FBQyxDQUFSLEdBQVksQ0FoUVosQ0FBQTs7QUFBQSxPQWlRTyxDQUFDLFNBQVIsR0FBb0IsU0FqUXBCLENBQUE7O0FBQUEsT0FrUU8sQ0FBQyxNQUFSLEdBQWlCLE1BbFFqQixDQUFBOztBQUFBLE9BbVFPLENBQUMsY0FBUixHQUF5QixjQW5RekIsQ0FBQTs7QUFBQSxPQW9RTyxDQUFDLE9BQVIsR0FBa0IsT0FwUWxCLENBQUE7O0FBQUEsT0FxUU8sQ0FBQyxVQUFSLEdBQXFCLFVBclFyQixDQUFBOztBQUFBLE9Bc1FPLENBQUMsS0FBUixHQUFnQixLQXRRaEIsQ0FBQTs7QUFBQSxPQXVRTyxDQUFDLE1BQVIsR0FBaUIsTUF2UWpCLENBQUE7O0FBQUEsT0F3UU8sQ0FBQyxHQUFSLEdBQWMsR0F4UWQsQ0FBQTs7QUFBQSxPQXlRTyxDQUFDLElBQVIsR0FBZSxJQXpRZixDQUFBOztBQUFBLE9BMFFPLENBQUMsRUFBUixHQUFhLEVBMVFiLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJ1dWlkID0gcmVxdWlyZSBcIm5vZGUtdXVpZFwiXG5cbmNsYXNzIE5hbWVTcGFjZVxuXG4gICAgY29uc3RydWN0b3I6IChAbmFtZSwgc2VwKSAtPlxuICAgICAgICBAbmFtZXMgPSBbXVxuICAgICAgICBAc3ltYm9scyA9IHt9XG4gICAgICAgIEBzZXAgPSBzZXAgfHwgXCIuXCJcblxuICAgIGludGVybjogKHN5bWJvbCkgLT5cbiAgICAgICAgaWYgbm90IEBzeW1ib2xzW3N5bWJvbC5uYW1lXVxuICAgICAgICAgICAgQG5hbWVzLnB1c2goc3ltYm9sLm5hbWUpXG4gICAgICAgICAgICBAc3ltYm9sc1tzeW1ib2wubmFtZV0gPSBzeW1ib2xcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQHN5bWJvbHNbc3ltYm9sLm5hbWVdID0gc3ltYm9sXG5cbiAgICAgICAgc3ltYm9sLm5zID0gdGhpc1xuXG4gICAgdW5pbnRlcm46IChzeW1ib2wpIC0+XG4gICAgICAgIGRlbGV0ZSBAc3ltYm9sc1tzeW1ib2wubmFtZV1cbiAgICAgICAgQG5hbWVzID0gKGl0ZW0gZm9yIGl0ZW0gaW4gQG5hbWVzIHdoZW4gaXRlbSAhPSBzeW1ib2wubmFtZSlcbiAgICAgICAgc3ltYm9sLm5zID0gdW5kZWZpbmVkXG5cbiAgICBnZXRTeW1ib2w6IChuYW1lKSAtPlxuICAgICAgICBAc3ltYm9sc1tuYW1lXVxuXG4gICAgZ2V0OiAobmFtZSkgLT5cbiAgICAgICAgQHN5bWJvbHNbbmFtZV0udmFsdWVcblxuICAgIGFsbFN5bWJvbHM6ICgpIC0+XG4gICAgICAgIHN5bWJvbHMgPSBbXVxuXG4gICAgICAgIGZvciBuYW1lIGluIEBuYW1lc1xuICAgICAgICAgICAgc3ltYm9scy5wdXNoKEBzeW1ib2xzW25hbWVdKVxuXG4gICAgICAgIHJldHVybiBzeW1ib2xzXG5cbiAgICBhbGw6ICgpIC0+XG4gICAgICAgIHZhbHVlcyA9IFtdXG5cbiAgICAgICAgZm9yIG5hbWUgaW4gQG5hbWVzXG4gICAgICAgICAgICB2YWx1ZXMucHVzaChAc3ltYm9sc1tuYW1lXS52YWx1ZSlcblxuICAgICAgICByZXR1cm4gdmFsdWVzXG5cblxuY2xhc3MgU3ltYm9sXG5cbiAgICBjb25zdHJ1Y3RvcjogKEBuYW1lLCBAdmFsdWUsIEBucykgLT5cbiAgICAgICAgQHV1aWQgPSB1dWlkLnY0KClcblxuICAgIGlzOiAoc3ltYm9sLCBkZWVwKSAtPlxuICAgICAgIGVxdWFsaXR5ID0ge1xuICAgICAgICAgICBuYW1lczogLTFcbiAgICAgICAgICAgbmFtZXNwYWNlczogLTFcbiAgICAgICAgICAgYXR0cnM6IC0xXG4gICAgICAgfVxuXG4gICAgICAgaWYgQG5hbWUgPT0gc3ltYm9sLm5hbWVcbiAgICAgICAgICAgZXF1YWxpdHkubmFtZXMgPSAxXG5cbiAgICAgICBpZiAhQG5zXG4gICAgICAgICAgIGVxdWFsaXR5Lm5hbWVzcGFjZXMgPSAxXG4gICAgICAgZWxzZSBpZiBAbnMgYW5kIEBucy5pZCBpcyBzeW1ib2wuaWRcbiAgICAgICAgICAgZXF1YWxpdHkubmFtZXNwYWNlcyA9IDFcblxuICAgICAgIGVxdWFsaXR5LmF0dHJzID0gMVxuXG4gICAgICAgZm9yIGssdiBpbiB0aGlzXG4gICAgICAgICAgIGlmIHYgIT0gc3ltYm9sW2tdXG4gICAgICAgICAgICAgICBlcXVhbGl0eS5hdHRycyA9IC0xXG5cbiAgICAgICBpZiBkZWVwXG4gICAgICAgICAgIGlmIGVxdWFsaXR5Lm5hbWVzID09IDEgYW5kIGVxdWFsaXR5Lm5hbWVzcGFjZXMgPT0xIGFuZCBlcXVhbGl0eS5hdHRycyA9PSAxXG4gICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgIGVsc2VcbiAgICAgICAgICAgaWYgZXF1YWxpdHkubmFtZXMgPT0gMSBhbmQgZXF1YWxpdHkubmFtZXNwYWNlcyA9PTFcbiAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG5cbiAgICAgICByZXR1cm4gZmFsc2VcblxuICAgIHRvU3RyaW5nOiAtPlxuICAgICAgIGlmIEBuc1xuICAgICAgICAgICByZXR1cm4gQG5zLmlkICsgQG5zLnNlcCArIEBuYW1lXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgcmV0dXJuIEBuYW1lXG5cblMgPSAobmFtZSkgLT5cbiAgICByZXR1cm4gbmV3IFN5bWJvbChuYW1lKVxuXG5cbmNsYXNzIFRva2VuIGV4dGVuZHMgU3ltYm9sXG5cbiAgICBjb25zdHJ1Y3RvcjogKEBuYW1lKSAtPlxuICAgICAgICBAYXBwZW5kKEBuYW1lKVxuXG4gICAgYXBwZW5kOiAoQG5hbWUpIC0+XG4gICAgICAgIEB2YWx1ZSA9IEBuYW1lXG4gICAgICAgIGlmIHR5cGVvZiBAbmFtZSBpcyBcInN0cmluZ1wiXG4gICAgICAgICAgICB0aGlzW0BuYW1lXSA9IHRydWVcblxuXG5UID0gKG5hbWUpIC0+XG4gICAgcmV0dXJuIG5ldyBUb2tlbihuYW1lKVxuXG5jbGFzcyBFdmVudCBleHRlbmRzIFN5bWJvbFxuXG4gICAgY29uc3RydWN0b3I6IChAbmFtZSwgQHBheWxvYWQpIC0+XG5cbmNsYXNzIEVudGl0eSBleHRlbmRzIFN5bWJvbFxuXG4gICAgY29uc3RydWN0b3I6IChAbmFtZSwgQHRhZ3MsIEB2YWx1ZSkgLT5cblxuY2xhc3MgQ29tcG9uZW50IGV4dGVuZHMgU3ltYm9sXG5cbiAgICBjb25zdHJ1Y3RvcjogKEBuYW1lLCBhdHRycykgLT5cbiAgICAgICAgZm9yIGssIHYgaW4gYXR0cnNcbiAgICAgICAgICAgIHRoaXNba10gPSB2XG5cbmNsYXNzIFN5c3RlbVxuXG4gICAgY29uc3RydWN0b3I6KEBmbG93LCBAb3B0aW9ucykgLT5cbiAgICAgICAgQGhhbmRsZXJzID0gbnVsbFxuXG4gICAgcHVzaDogKGRhdGEsIGlubGV0KSAtPlxuXG4gICAgIyBqdXN0IGRhdGEgZm9yIHNpbmdsZSBpbmxldFxuICAgIHdoZW5SZWFkeTogKGhhbmRsZXIsIG91dGxldCkgLT5cblxuICAgICAgICBpZiBub3Qgb3V0bGV0XG4gICAgICAgICAgICBpZiBAaGFuZGxlcnNcbiAgICAgICAgICAgICAgIEBoYW5kbGVycy5wdXNoKGhhbmRsZXIpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICBAaGFuZGxlcnMgPSBbaGFuZGxlcl1cblxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpZiBAaGFuZGxlcnNcbiAgICAgICAgICAgICAgICBAaGFuZGxlcnMub3V0bGV0LnB1c2goaGFuZGxlcilcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBAaGFuZGxlcnMub3V0bGV0ID0gW2hhbmRsZXJdXG5cblxuXG4gICAgZW1pdDogKGRhdGEsIG91dGxldCkgLT5cbiAgICAgICAgaWYgbm90IG91dGxldFxuICAgICAgICAgICAgZm9yIGhhbmRsZXIgaW4gQGhhbmRsZXJzXG4gICAgICAgICAgICAgICAgaGFuZGxlcihkYXRhKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBmb3IgaGFuZGxlciBpbiBAaGFuZGxlcnNbb3V0bGV0XVxuICAgICAgICAgICAgICAgIGhhbmRsZXIoZGF0YSlcblxuY2xhc3MgRGlzY3JldGVTeXN0ZW1cblxuICAgIGNvbnN0cnVjdG9yOiAoQGZsb3csIEBldmVudHMpIC0+XG5cbiAgICByYWlzZTogKGV2ZW50KSAtPlxuXG5jbGFzcyBDaGFubmVsXG5cbiAgICBjb25zdHJ1Y3RvcjogKEBpbmxldCwgQG91dGxldCkgLT5cblxuY2xhc3MgQ29ubmVjdGlvblxuXG4gICAgY29uc3RydWN0b3I6IChzb3VyY2UsIHNpbmssIEBmbG93LCBAY2hhbm5lbHMpIC0+XG4gICAgICAgIEBzb3VyY2UgPSBAZmxvdy5zeXN0ZW1zLmdldChzb3VyY2UpXG4gICAgICAgIEBzaW5rID0gQGZsb3cuc3lzdGVtcy5nZXQoc2luaylcblxuXG5jbGFzcyBCdXNcblxuICAgIGNvbnN0cnVjdG9yOiAtPlxuICAgICAgICBAZW50aXRpZXMgPSBuZXcgTmFtZVNwYWNlKFwiYnVzLmVudGl0aWVzXCIpXG4gICAgICAgIEBkaXNjcmV0ZVN5c3RlbXMgPSBuZXcgTmFtZVNwYWNlKFwiYnVzLnN5c3RlbXNcIilcblxuICAgIGFkZERpc2NyZXRlU3lzdGVtOiAoaWQsIGRpc2NyZXRlU3lzdGVtQ2xhc3MpIC0+XG4gICAgICAgIGRpc2NyZXRlX3N5dGVtID0gbmV3IGRpc2NyZXRlU3lzdGVtQ2xhc3ModGhpcylcbiAgICAgICAgaWQudmFsdWUgPSBkaXNjcmV0ZV9zeXRlbVxuICAgICAgICBAZGlzY3JldGVTeXN0ZW1zLmludGVybihpZClcblxuICAgIGNyZWF0ZUVudGl0eTogKG5hbWUsIHRhZ3MsIHZhbHVlKSAtPlxuICAgICAgICB0YWdzID0gdGFncyB8fCBbXVxuICAgICAgICB2YWx1ZSA9IHZhbHVlIHx8IHVuZGVmaW5lZFxuICAgICAgICBlbnRpdHkgPSBuZXcgRW50aXR5KG5hbWUsIHRhZ3MsIHZhbHVlKVxuICAgICAgICBAZW50aXRpZXMuaW50ZXJuKGVudGl0eSlcbiAgICAgICAgZW50aXR5XG5cbiAgICBnZXRFbnRpdHk6IChuYW1lLCB2YWx1ZSkgLT5cbiAgICAgICAgaWYgQGVudGl0aWVzLmdldFN5bWJvbChuYW1lKVxuICAgICAgICAgICAgcmV0dXJuIEBlbnRpdGllcy5nZXRTeW1ib2wobmFtZSlcbiAgICAgICAgZWxzZSBpZiB2YWx1ZVxuICAgICAgICAgICAgcmV0dXJuIEBjcmVhdGVFbnRpdHkobmFtZSwgdmFsdWUpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsXG5cbiAgICBnZXRFbnRpdGllc0J5VGFnczogKHRhZ3MpIC0+XG4gICAgICAgIGVudGl0aWVzID0gW11cbiAgICAgICAgZm9yIGVudGl0eSBpbiBAZW50aXRpZXMuYWxsU3ltYm9scygpXG4gICAgICAgICAgICBmb3IgdGFnIGluIHRhZ3NcbiAgICAgICAgICAgICAgICBpZiB0YWcgaW4gZW50aXR5LnRhZ3NcbiAgICAgICAgICAgICAgICAgICAgZW50aXRpZXMucHVzaCBlbnRpdHlcblxuICAgICAgICByZXR1cm4gZW50aXRpZXNcblxuXG4gICAgdHJpZ2dlcjogKGV2ZW50KSAtPlxuXG4gICAgICAgIGZvciBzeW1ib2wgaW4gQGRpc2NyZXRlU3lzdGVtcy5hbGxTeW1ib2xzKClcbiAgICAgICAgICAgIGlmIGV2ZW50Lm5hbWUgaW4gc3ltYm9sLmV2ZW50c1xuICAgICAgICAgICAgICAgIHN5bWJvbC52YWx1ZS5yYWlzZShldmVudClcblxuY2xhc3MgRmxvd1xuXG4gICAgY29uc3RydWN0b3I6IChAaWQpIC0+XG4gICAgICAgIEBidXMgPSBuZXcgQnVzXG4gICAgICAgIEBzeXN0ZW1zID0gbmV3IE5hbWVTcGFjZShcInN5c3RlbXNcIilcbiAgICAgICAgQGNvbm5lY3Rpb25zID0gbmV3IE5hbWVTcGFjZShcInN5c3RlbXMuY29ubmVjdGlvbnNcIilcbiAgICAgICAgQHZpZXdzID0gbmV3IE5hbWVTcGFjZShcInN5c3RlbXMudmlld3NcIilcblxuICAgIGNvbm5lY3Q6IChpZCwgc291cmNlLCBzaW5rLCBjaGFubmVscykgLT5cbiAgICAgICAgY29ubmVjdGlvbiA9IG5ldyBDb25uZWN0aW9uKHNvdXJjZSwgc2luaywgdGhpcywgY2hhbm5lbHMpXG5cbiAgICAgICAgaWYgY29ubmVjdGlvbi5jaGFubmVsc1xuICAgICAgICAgICAgZm9yIGNoYW5uZWwgaW4gY29ubmVjdGlvbi5jaGFubmVsc1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uc291cmNlLndoZW5SZWFkeSgoKChkYXRhKSAtPlxuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnNpbmsucHVzaC5jYWxsKGNvbm5lY3Rpb24uc2luaywgY2hhbm5lbC5pbmxldCwgZGF0YSkpKSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbC5vdXRsZXQpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGNvbm5lY3Rpb24uc291cmNlLndoZW5SZWFkeSgoKGRhdGEpIC0+XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5zaW5rLnB1c2goZGF0YSkpKVxuXG4gICAgICAgIGlmICFpZC5uYW1lXG4gICAgICAgICAgICBpZC5uYW1lID0gXCIje3NvdXJjZX0tI3tzaW5rfVwiXG5cbiAgICAgICAgaWQudmFsdWUgPSBjb25uZWN0aW9uXG4gICAgICAgIEBjb25uZWN0aW9ucy5pbnRlcm4oaWQpXG5cbiAgICBhZGRTeXN0ZW06IChpZCwgc3lzdGVtQ2xhc3MsIG9wdGlvbnMpIC0+XG4gICAgICAgIHN5c3RlbSA9IG5ldyBzeXN0ZW1DbGFzcyh0aGlzLCBvcHRpb25zKVxuICAgICAgICBpZC52YWx1ZSA9IHN5c3RlbVxuICAgICAgICBAc3lzdGVtcy5pbnRlcm4oaWQpXG5cbiAgICBhZGRWaWV3OiAoaWQsIHZpZXdDbGFzcywgb3B0aW9ucykgLT5cbiAgICAgICAgdmlldyA9IG5ldyB2aWV3Q2xhc3ModGhpcywgb3B0aW9ucylcbiAgICAgICAgaWQudmFsdWUgPSB2aWV3XG4gICAgICAgIEB2aWV3cy5pbnRlcm4oaWQpXG5cblxuY2xhc3MgR09cblxuICAgIGNvbnN0cnVjdG9yOiAoQGZsb3csIG9wdGlvbnMpIC0+XG4gICAgc2hvdzogKGRhdGEpIC0+XG4gICAgaW50ZXJhY3Q6IChkYXRhKSAtPlxuXG5leHBvcnRzLlN5bWJvbCA9IFN5bWJvbFxuZXhwb3J0cy5TID0gU1xuZXhwb3J0cy5Ub2tlbiA9IFRva2VuXG5leHBvcnRzLlQgPSBUXG5leHBvcnRzLk5hbWVTcGFjZSA9IE5hbWVTcGFjZVxuZXhwb3J0cy5TeXN0ZW0gPSBTeXN0ZW1cbmV4cG9ydHMuRGlzY3JldGVTeXN0ZW0gPSBEaXNjcmV0ZVN5c3RlbVxuZXhwb3J0cy5DaGFubmVsID0gQ2hhbm5lbFxuZXhwb3J0cy5Db25uZWN0aW9uID0gQ29ubmVjdGlvblxuZXhwb3J0cy5FdmVudCA9IEV2ZW50XG5leHBvcnRzLkVudGl0eSA9IEVudGl0eVxuZXhwb3J0cy5CdXMgPSBCdXNcbmV4cG9ydHMuRmxvdyA9IEZsb3dcbmV4cG9ydHMuR08gPSBHT1xuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=