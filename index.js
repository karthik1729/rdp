var Channel, Component, Connection, DiscreteSystem, Entity, Event, Flow, Message, NameSpace, S, StateBus, Symbol, System, T, Token,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

NameSpace = (function() {
  function NameSpace(name, sep) {
    this.name = name;
    this.names = [];
    this.symbols = {};
    this.sep = sep || ".";
  }

  NameSpace.prototype.intern = function(symbol) {
    if (!this.symbols[symbol.name]) {
      this.names.push(symbol.name);
      this.symbols[symbol.name] = symbol;
    } else {
      this.symbols[symbol.name] = symbol;
    }
    return symbol.ns = this;
  };

  NameSpace.prototype.unintern = function(symbol) {
    var item;
    delete this.symbols[symbol.name];
    this.names = (function() {
      var _i, _len, _ref, _results;
      _ref = this.names;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        item = _ref[_i];
        if (item !== symbol.name) {
          _results.push(item);
        }
      }
      return _results;
    }).call(this);
    return symbol.ns = void 0;
  };

  NameSpace.prototype.getSymbol = function(name) {
    return this.symbols[name];
  };

  NameSpace.prototype.get = function(name) {
    return this.symbols[name].value;
  };

  NameSpace.prototype.allSymbols = function() {
    var name, symbols, _i, _len, _ref;
    symbols = [];
    _ref = this.names;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      name = _ref[_i];
      symbols.push(this.symbols[name]);
    }
    return symbols;
  };

  NameSpace.prototype.all = function() {
    var name, values, _i, _len, _ref;
    values = [];
    _ref = this.names;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      name = _ref[_i];
      values.push(this.symbols[name].value);
    }
    return values;
  };

  return NameSpace;

})();

Symbol = (function() {
  function Symbol(name, value, ns) {
    this.name = name;
    this.value = value;
    this.ns = ns;
  }

  Symbol.prototype.is = function(symbol, deep) {
    var equality, k, v, _i, _len;
    equality = {
      names: -1,
      namespaces: -1,
      attrs: -1
    };
    if (this.name === symbol.name) {
      equality.names = 1;
    }
    if (!this.ns) {
      equality.namespaces = 1;
    } else if (this.ns && this.ns.id === symbol.id) {
      equality.namespaces = 1;
    }
    equality.attrs = 1;
    for (v = _i = 0, _len = this.length; _i < _len; v = ++_i) {
      k = this[v];
      if (v !== symbol[k]) {
        equality.attrs = -1;
      }
    }
    if (deep) {
      if (equality.names === 1 && equality.namespaces === 1 && equality.attrs === 1) {
        return true;
      }
    } else {
      if (equality.names === 1 && equality.namespaces === 1) {
        return true;
      }
    }
    return false;
  };

  Symbol.prototype.toString = function() {
    if (this.ns) {
      return this.ns.id + this.ns.sep + this.name;
    } else {
      return this.name;
    }
  };

  return Symbol;

})();

S = function(name) {
  return new Symbol(name);
};

Token = (function(_super) {
  __extends(Token, _super);

  function Token(name) {
    this.name = name;
    this.value = this.name;
    if (typeof this.name === "string") {
      this[this.name] = true;
    }
  }

  return Token;

})(Symbol);

T = function(name) {
  return new Token(name);
};

Event = (function(_super) {
  __extends(Event, _super);

  function Event(name, context) {
    this.name = name;
    this.context = context;
  }

  return Event;

})(Symbol);

Message = (function(_super) {
  __extends(Message, _super);

  function Message(type, payload) {
    this.type = type;
    this.payload = payload;
    this.name = "message." + this.type;
  }

  return Message;

})(Symbol);

Entity = (function(_super) {
  __extends(Entity, _super);

  function Entity(name, tags, value) {
    this.name = name;
    this.tags = tags;
    this.value = value;
  }

  return Entity;

})(Symbol);

Component = (function(_super) {
  __extends(Component, _super);

  function Component(name, attrs) {
    var k, v, _i, _len;
    this.name = name;
    for (v = _i = 0, _len = attrs.length; _i < _len; v = ++_i) {
      k = attrs[v];
      this[k] = v;
    }
  }

  return Component;

})(Symbol);

System = (function() {
  function System(flow) {
    this.flow = flow;
    this.handlers = null;
  }

  System.prototype.push = function(data, inlet) {};

  System.prototype.whenReady = function(handler, outlet) {
    if (!outlet) {
      if (this.handlers) {
        return this.handlers.push(handler);
      } else {
        console.log(this);
        return this.handlers = [handler];
      }
    } else {
      if (this.handlers) {
        return this.handlers.outlet.push(handler);
      } else {
        return this.handlers.outlet = [handler];
      }
    }
  };

  System.prototype.emit = function(data, outlet) {
    var handler, _i, _j, _len, _len1, _ref, _ref1, _results, _results1;
    if (!outlet) {
      _ref = this.handlers;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        handler = _ref[_i];
        _results.push(handler(data));
      }
      return _results;
    } else {
      _ref1 = this.handlers[outlet];
      _results1 = [];
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        handler = _ref1[_j];
        _results1.push(handler(data));
      }
      return _results1;
    }
  };

  return System;

})();

DiscreteSystem = (function() {
  function DiscreteSystem(flow, events) {
    this.flow = flow;
    this.events = events;
  }

  DiscreteSystem.prototype.raise = function(message) {};

  return DiscreteSystem;

})();

Channel = (function() {
  function Channel(inlet, outlet) {
    this.inlet = inlet;
    this.outlet = outlet;
  }

  return Channel;

})();

Connection = (function() {
  function Connection(source, sink, flow, channels) {
    this.flow = flow;
    this.channels = channels;
    this.source = this.flow.systems.get(source);
    this.sink = this.flow.systems.get(sink);
  }

  return Connection;

})();

StateBus = (function() {
  function StateBus() {
    this.entities = new NameSpace();
    this.discreteSystems = new NameSpace();
  }

  StateBus.prototype.addDiscreteSystem = function(id, discreteSystemClass) {
    var discrete_sytem;
    discrete_sytem = new discreteSystemClass(this);
    id.value = discrete_sytem;
    return this.discreteSystems.intern(id);
  };

  StateBus.prototype.createEntity = function(name, tags, value) {
    var entity;
    tags = tags || [];
    value = value || void 0;
    entity = new Entity(name, tags, value);
    this.entities.intern(entity);
    return entity;
  };

  StateBus.prototype.getEntity = function(name, create) {
    if (this.entities.getSymbol(name)) {
      return this.entities.getSymbol(name);
    } else if (create) {
      return this.createEntity(name);
    } else {
      return null;
    }
  };

  StateBus.prototype.getEntitiesByTags = function(tags) {
    var entities, entity, tag, _i, _j, _len, _len1, _ref;
    entities = [];
    _ref = this.entities.all();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      entity = _ref[_i];
      for (_j = 0, _len1 = tags.length; _j < _len1; _j++) {
        tag = tags[_j];
        if (__indexOf.call(entity.tags, tag) >= 0) {
          entities.push(entity);
        }
      }
    }
    return entities;
  };

  StateBus.prototype.trigger = function(event, message) {
    var system, _i, _len, _ref, _results;
    _ref = this.discreteSystems[event];
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      system = _ref[_i];
      message = Message(event, message);
      _results.push(system.raise(message));
    }
    return _results;
  };

  return StateBus;

})();

Flow = (function() {
  function Flow(id) {
    this.id = id;
    this.bus = new StateBus;
    this.systems = new NameSpace("systems");
    this.connections = new NameSpace("systems.connections");
  }

  Flow.prototype.connect = function(id, source, sink, channels) {
    var channel, connection, _i, _len, _ref;
    connection = new Connection(source, sink, this, channels);
    if (connection.channels) {
      _ref = connection.channels;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        channel = _ref[_i];
        connection.source.prototype.whenReady.call(connection.source, (function(data) {
          return connection.sink.prototype.push.call(connection.sink, channel.inlet, data);
        }), channel.outlet);
      }
    } else {
      connection.source.prototype.whenReady.call(connection.source, (function(data) {
        return connection.sink.push(data);
      }));
    }
    id.value = connection;
    return this.connections.intern(id);
  };

  Flow.prototype.addSystem = function(id, systemClass) {
    var system;
    system = new systemClass(this);
    id.value = system;
    return this.systems.intern(id);
  };

  Flow.prototype.serialize = function() {
    var connection, system, xml, _i, _j, _len, _len1, _ref, _ref1;
    xml = "<xml>";
    xml += "<flow name='" + this.id.name + "'>";
    _ref = this.systems.all();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      system = _ref[_i];
      xml += "<system>";
      xml += "</system>";
    }
    _ref1 = this.connections.all();
    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
      connection = _ref1[_j];
      xml += "<connection>";
      xml += "</connection>";
    }
    xml = "</flow>";
    return xml = "</xml>";
  };

  Flow.prototype.log = function(x) {
    return console.log(x);
  };

  return Flow;

})();

exports.Symbol = Symbol;

exports.S = S;

exports.Token = Token;

exports.T = T;

exports.NameSpace = NameSpace;

exports.System = System;

exports.Channel = Channel;

exports.Connection = Connection;

exports.Message = Message;

exports.Entity = Entity;

exports.StateBus = StateBus;

exports.Flow = Flow;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLDhIQUFBO0VBQUE7O3VKQUFBOztBQUFBO0FBRWlCLEVBQUEsbUJBQUUsSUFBRixFQUFRLEdBQVIsR0FBQTtBQUNULElBRFUsSUFBQyxDQUFBLE9BQUEsSUFDWCxDQUFBO0FBQUEsSUFBQSxJQUFDLENBQUEsS0FBRCxHQUFTLEVBQVQsQ0FBQTtBQUFBLElBQ0EsSUFBQyxDQUFBLE9BQUQsR0FBVyxFQURYLENBQUE7QUFBQSxJQUVBLElBQUMsQ0FBQSxHQUFELEdBQU8sR0FBQSxJQUFPLEdBRmQsQ0FEUztFQUFBLENBQWI7O0FBQUEsc0JBS0EsTUFBQSxHQUFRLFNBQUMsTUFBRCxHQUFBO0FBQ0osSUFBQSxJQUFHLENBQUEsSUFBSyxDQUFBLE9BQVEsQ0FBQSxNQUFNLENBQUMsSUFBUCxDQUFoQjtBQUNJLE1BQUEsSUFBQyxDQUFBLEtBQUssQ0FBQyxJQUFQLENBQVksTUFBTSxDQUFDLElBQW5CLENBQUEsQ0FBQTtBQUFBLE1BQ0EsSUFBQyxDQUFBLE9BQVEsQ0FBQSxNQUFNLENBQUMsSUFBUCxDQUFULEdBQXdCLE1BRHhCLENBREo7S0FBQSxNQUFBO0FBSUksTUFBQSxJQUFDLENBQUEsT0FBUSxDQUFBLE1BQU0sQ0FBQyxJQUFQLENBQVQsR0FBd0IsTUFBeEIsQ0FKSjtLQUFBO1dBTUEsTUFBTSxDQUFDLEVBQVAsR0FBWSxLQVBSO0VBQUEsQ0FMUixDQUFBOztBQUFBLHNCQWNBLFFBQUEsR0FBVSxTQUFDLE1BQUQsR0FBQTtBQUNOLFFBQUEsSUFBQTtBQUFBLElBQUEsTUFBQSxDQUFBLElBQVEsQ0FBQSxPQUFRLENBQUEsTUFBTSxDQUFDLElBQVAsQ0FBaEIsQ0FBQTtBQUFBLElBQ0EsSUFBQyxDQUFBLEtBQUQ7O0FBQVU7QUFBQTtXQUFBLDJDQUFBO3dCQUFBO1lBQTZCLElBQUEsS0FBUSxNQUFNLENBQUM7QUFBNUMsd0JBQUEsS0FBQTtT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QSxHQUFNLFNBWE4sQ0FBQTtXQVlBLEdBQUEsR0FBTSxTQWJDO0VBQUEsQ0F6QlgsQ0FBQTs7QUFBQSxpQkF3Q0EsR0FBQSxHQUFLLFNBQUMsQ0FBRCxHQUFBO1dBQ0QsT0FBTyxDQUFDLEdBQVIsQ0FBWSxDQUFaLEVBREM7RUFBQSxDQXhDTCxDQUFBOztjQUFBOztJQXJOSixDQUFBOztBQUFBLE9BaVFPLENBQUMsTUFBUixHQUFpQixNQWpRakIsQ0FBQTs7QUFBQSxPQWtRTyxDQUFDLENBQVIsR0FBWSxDQWxRWixDQUFBOztBQUFBLE9BbVFPLENBQUMsS0FBUixHQUFnQixLQW5RaEIsQ0FBQTs7QUFBQSxPQW9RTyxDQUFDLENBQVIsR0FBWSxDQXBRWixDQUFBOztBQUFBLE9BcVFPLENBQUMsU0FBUixHQUFvQixTQXJRcEIsQ0FBQTs7QUFBQSxPQXNRTyxDQUFDLE1BQVIsR0FBaUIsTUF0UWpCLENBQUE7O0FBQUEsT0F1UU8sQ0FBQyxPQUFSLEdBQWtCLE9BdlFsQixDQUFBOztBQUFBLE9Bd1FPLENBQUMsVUFBUixHQUFxQixVQXhRckIsQ0FBQTs7QUFBQSxPQXlRTyxDQUFDLE9BQVIsR0FBa0IsT0F6UWxCLENBQUE7O0FBQUEsT0EwUU8sQ0FBQyxNQUFSLEdBQWlCLE1BMVFqQixDQUFBOztBQUFBLE9BMlFPLENBQUMsUUFBUixHQUFtQixRQTNRbkIsQ0FBQTs7QUFBQSxPQTRRTyxDQUFDLElBQVIsR0FBZSxJQTVRZixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgTmFtZVNwYWNlXG5cbiAgICBjb25zdHJ1Y3RvcjogKEBuYW1lLCBzZXApIC0+XG4gICAgICAgIEBuYW1lcyA9IFtdXG4gICAgICAgIEBzeW1ib2xzID0ge31cbiAgICAgICAgQHNlcCA9IHNlcCB8fCBcIi5cIlxuXG4gICAgaW50ZXJuOiAoc3ltYm9sKSAtPlxuICAgICAgICBpZiBub3QgQHN5bWJvbHNbc3ltYm9sLm5hbWVdXG4gICAgICAgICAgICBAbmFtZXMucHVzaChzeW1ib2wubmFtZSlcbiAgICAgICAgICAgIEBzeW1ib2xzW3N5bWJvbC5uYW1lXSA9IHN5bWJvbFxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAc3ltYm9sc1tzeW1ib2wubmFtZV0gPSBzeW1ib2xcblxuICAgICAgICBzeW1ib2wubnMgPSB0aGlzXG5cbiAgICB1bmludGVybjogKHN5bWJvbCkgLT5cbiAgICAgICAgZGVsZXRlIEBzeW1ib2xzW3N5bWJvbC5uYW1lXVxuICAgICAgICBAbmFtZXMgPSAoaXRlbSBmb3IgaXRlbSBpbiBAbmFtZXMgd2hlbiBpdGVtICE9IHN5bWJvbC5uYW1lKVxuICAgICAgICBzeW1ib2wubnMgPSB1bmRlZmluZWRcblxuICAgIGdldFN5bWJvbDogKG5hbWUpIC0+XG4gICAgICAgIEBzeW1ib2xzW25hbWVdXG5cbiAgICBnZXQ6IChuYW1lKSAtPlxuICAgICAgICBAc3ltYm9sc1tuYW1lXS52YWx1ZVxuXG4gICAgYWxsU3ltYm9sczogKCkgLT5cbiAgICAgICAgc3ltYm9scyA9IFtdXG5cbiAgICAgICAgZm9yIG5hbWUgaW4gQG5hbWVzXG4gICAgICAgICAgICBzeW1ib2xzLnB1c2goQHN5bWJvbHNbbmFtZV0pXG5cbiAgICAgICAgcmV0dXJuIHN5bWJvbHNcblxuICAgIGFsbDogKCkgLT5cbiAgICAgICAgdmFsdWVzID0gW11cblxuICAgICAgICBmb3IgbmFtZSBpbiBAbmFtZXNcbiAgICAgICAgICAgIHZhbHVlcy5wdXNoKEBzeW1ib2xzW25hbWVdLnZhbHVlKVxuXG4gICAgICAgIHJldHVybiB2YWx1ZXNcblxuXG5jbGFzcyBTeW1ib2xcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUsIEB2YWx1ZSwgQG5zKSAtPlxuXG4gICAgaXM6IChzeW1ib2wsIGRlZXApIC0+XG4gICAgICAgZXF1YWxpdHkgPSB7XG4gICAgICAgICAgIG5hbWVzOiAtMVxuICAgICAgICAgICBuYW1lc3BhY2VzOiAtMVxuICAgICAgICAgICBhdHRyczogLTFcbiAgICAgICB9XG5cbiAgICAgICBpZiBAbmFtZSA9PSBzeW1ib2wubmFtZVxuICAgICAgICAgICBlcXVhbGl0eS5uYW1lcyA9IDFcblxuICAgICAgIGlmICFAbnNcbiAgICAgICAgICAgZXF1YWxpdHkubmFtZXNwYWNlcyA9IDFcbiAgICAgICBlbHNlIGlmIEBucyBhbmQgQG5zLmlkIGlzIHN5bWJvbC5pZFxuICAgICAgICAgICBlcXVhbGl0eS5uYW1lc3BhY2VzID0gMVxuXG4gICAgICAgZXF1YWxpdHkuYXR0cnMgPSAxXG5cbiAgICAgICBmb3Igayx2IGluIHRoaXNcbiAgICAgICAgICAgaWYgdiAhPSBzeW1ib2xba11cbiAgICAgICAgICAgICAgIGVxdWFsaXR5LmF0dHJzID0gLTFcblxuICAgICAgIGlmIGRlZXBcbiAgICAgICAgICAgaWYgZXF1YWxpdHkubmFtZXMgPT0gMSBhbmQgZXF1YWxpdHkubmFtZXNwYWNlcyA9PTEgYW5kIGVxdWFsaXR5LmF0dHJzID09IDFcbiAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgZWxzZVxuICAgICAgICAgICBpZiBlcXVhbGl0eS5uYW1lcyA9PSAxIGFuZCBlcXVhbGl0eS5uYW1lc3BhY2VzID09MVxuICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcblxuICAgICAgIHJldHVybiBmYWxzZVxuXG4gICAgdG9TdHJpbmc6IC0+XG4gICAgICAgaWYgQG5zXG4gICAgICAgICAgIHJldHVybiBAbnMuaWQgKyBAbnMuc2VwICsgQG5hbWVcbiAgICAgICAgZWxzZVxuICAgICAgICAgICByZXR1cm4gQG5hbWVcblxuUyA9IChuYW1lKSAtPlxuICAgIHJldHVybiBuZXcgU3ltYm9sKG5hbWUpXG5cblxuY2xhc3MgVG9rZW4gZXh0ZW5kcyBTeW1ib2xcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUpIC0+XG4gICAgICAgIEB2YWx1ZSA9IEBuYW1lXG4gICAgICAgIGlmIHR5cGVvZiBAbmFtZSBpcyBcInN0cmluZ1wiXG4gICAgICAgICAgICB0aGlzW0BuYW1lXSA9IHRydWVcblxuVCA9IChuYW1lKSAtPlxuICAgIHJldHVybiBuZXcgVG9rZW4obmFtZSlcblxuY2xhc3MgRXZlbnQgZXh0ZW5kcyBTeW1ib2xcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUsIEBjb250ZXh0KSAtPlxuXG5jbGFzcyBNZXNzYWdlIGV4dGVuZHMgU3ltYm9sXG5cbiAgICBjb25zdHJ1Y3RvcjogKEB0eXBlLCBAcGF5bG9hZCkgLT5cbiAgICAgICAgQG5hbWUgPSBcIm1lc3NhZ2UuXCIgKyBAdHlwZVxuXG5jbGFzcyBFbnRpdHkgZXh0ZW5kcyBTeW1ib2xcblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUsIEB0YWdzLCBAdmFsdWUpIC0+XG5cbmNsYXNzIENvbXBvbmVudCBleHRlbmRzIFN5bWJvbFxuXG4gICAgY29uc3RydWN0b3I6IChAbmFtZSwgYXR0cnMpIC0+XG4gICAgICAgIGZvciBrLCB2IGluIGF0dHJzXG4gICAgICAgICAgICB0aGlzW2tdID0gdlxuXG5cbmNsYXNzIFN5c3RlbVxuXG4gICAgY29uc3RydWN0b3I6KEBmbG93KSAtPlxuICAgICAgICBAaGFuZGxlcnMgPSBudWxsXG5cbiAgICBwdXNoOiAoZGF0YSwgaW5sZXQpIC0+XG5cbiAgICAjIGp1c3QgZGF0YSBmb3Igc2luZ2xlIGlubGV0XG4gICAgd2hlblJlYWR5OiAoaGFuZGxlciwgb3V0bGV0KSAtPlxuXG4gICAgICAgIGlmIG5vdCBvdXRsZXRcbiAgICAgICAgICAgIGlmIEBoYW5kbGVyc1xuICAgICAgICAgICAgICAgQGhhbmRsZXJzLnB1c2goaGFuZGxlcilcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMpXG4gICAgICAgICAgICAgICBAaGFuZGxlcnMgPSBbaGFuZGxlcl1cblxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpZiBAaGFuZGxlcnNcbiAgICAgICAgICAgICAgICBAaGFuZGxlcnMub3V0bGV0LnB1c2goaGFuZGxlcilcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBAaGFuZGxlcnMub3V0bGV0ID0gW2hhbmRsZXJdXG5cblxuXG4gICAgZW1pdDogKGRhdGEsIG91dGxldCkgLT5cbiAgICAgICAgaWYgbm90IG91dGxldFxuICAgICAgICAgICAgZm9yIGhhbmRsZXIgaW4gQGhhbmRsZXJzXG4gICAgICAgICAgICAgICAgaGFuZGxlcihkYXRhKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBmb3IgaGFuZGxlciBpbiBAaGFuZGxlcnNbb3V0bGV0XVxuICAgICAgICAgICAgICAgIGhhbmRsZXIoZGF0YSlcblxuY2xhc3MgRGlzY3JldGVTeXN0ZW1cblxuICAgIGNvbnN0cnVjdG9yOiAoQGZsb3csIEBldmVudHMpIC0+XG5cbiAgICByYWlzZTogKG1lc3NhZ2UpIC0+XG5cbmNsYXNzIENoYW5uZWxcblxuICAgIGNvbnN0cnVjdG9yOiAoQGlubGV0LCBAb3V0bGV0KSAtPlxuXG5jbGFzcyBDb25uZWN0aW9uXG5cbiAgICBjb25zdHJ1Y3RvcjogKHNvdXJjZSwgc2luaywgQGZsb3csIEBjaGFubmVscykgLT5cbiAgICAgICAgQHNvdXJjZSA9IEBmbG93LnN5c3RlbXMuZ2V0KHNvdXJjZSlcbiAgICAgICAgQHNpbmsgPSBAZmxvdy5zeXN0ZW1zLmdldChzaW5rKVxuXG5cblxuY2xhc3MgU3RhdGVCdXNcblxuICAgIGNvbnN0cnVjdG9yOiAtPlxuICAgICAgICBAZW50aXRpZXMgPSBuZXcgTmFtZVNwYWNlKClcbiAgICAgICAgQGRpc2NyZXRlU3lzdGVtcyA9IG5ldyBOYW1lU3BhY2UoKVxuXG4gICAgYWRkRGlzY3JldGVTeXN0ZW06IChpZCwgZGlzY3JldGVTeXN0ZW1DbGFzcykgLT5cbiAgICAgICAgZGlzY3JldGVfc3l0ZW0gPSBuZXcgZGlzY3JldGVTeXN0ZW1DbGFzcyh0aGlzKVxuICAgICAgICBpZC52YWx1ZSA9IGRpc2NyZXRlX3N5dGVtXG4gICAgICAgIEBkaXNjcmV0ZVN5c3RlbXMuaW50ZXJuKGlkKVxuXG4gICAgY3JlYXRlRW50aXR5OiAobmFtZSwgdGFncywgdmFsdWUpIC0+XG4gICAgICAgIHRhZ3MgPSB0YWdzIHx8IFtdXG4gICAgICAgIHZhbHVlID0gdmFsdWUgfHwgdW5kZWZpbmVkXG4gICAgICAgIGVudGl0eSA9IG5ldyBFbnRpdHkobmFtZSwgdGFncywgdmFsdWUpXG4gICAgICAgIEBlbnRpdGllcy5pbnRlcm4oZW50aXR5KVxuICAgICAgICBlbnRpdHlcblxuICAgIGdldEVudGl0eTogKG5hbWUsIGNyZWF0ZSkgLT5cbiAgICAgICAgaWYgQGVudGl0aWVzLmdldFN5bWJvbChuYW1lKVxuICAgICAgICAgICAgcmV0dXJuIEBlbnRpdGllcy5nZXRTeW1ib2wobmFtZSlcbiAgICAgICAgZWxzZSBpZiBjcmVhdGVcbiAgICAgICAgICAgIHJldHVybiBAY3JlYXRlRW50aXR5KG5hbWUpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsXG5cbiAgICBnZXRFbnRpdGllc0J5VGFnczogKHRhZ3MpIC0+XG4gICAgICAgIGVudGl0aWVzID0gW11cbiAgICAgICAgZm9yIGVudGl0eSBpbiBAZW50aXRpZXMuYWxsKClcbiAgICAgICAgICAgIGZvciB0YWcgaW4gdGFnc1xuICAgICAgICAgICAgICAgIGlmIHRhZyBpbiBlbnRpdHkudGFnc1xuICAgICAgICAgICAgICAgICAgICBlbnRpdGllcy5wdXNoIGVudGl0eVxuXG4gICAgICAgIHJldHVybiBlbnRpdGllc1xuXG5cbiAgICB0cmlnZ2VyOiAoZXZlbnQsIG1lc3NhZ2UpIC0+XG5cbiAgICAgICAgZm9yIHN5c3RlbSBpbiBAZGlzY3JldGVTeXN0ZW1zW2V2ZW50XVxuICAgICAgICAgICAgbWVzc2FnZSA9IE1lc3NhZ2UoZXZlbnQsIG1lc3NhZ2UpXG4gICAgICAgICAgICBzeXN0ZW0ucmFpc2UobWVzc2FnZSlcblxuY2xhc3MgRmxvd1xuXG4gICAgY29uc3RydWN0b3I6IChAaWQpIC0+XG4gICAgICAgIEBidXMgPSBuZXcgU3RhdGVCdXNcbiAgICAgICAgQHN5c3RlbXMgPSBuZXcgTmFtZVNwYWNlKFwic3lzdGVtc1wiKVxuICAgICAgICBAY29ubmVjdGlvbnMgPSBuZXcgTmFtZVNwYWNlKFwic3lzdGVtcy5jb25uZWN0aW9uc1wiKVxuXG4gICAgY29ubmVjdDogKGlkLCBzb3VyY2UsIHNpbmssIGNoYW5uZWxzKSAtPlxuICAgICAgICBjb25uZWN0aW9uID0gbmV3IENvbm5lY3Rpb24oc291cmNlLCBzaW5rLCB0aGlzLCBjaGFubmVscylcblxuICAgICAgICBpZiBjb25uZWN0aW9uLmNoYW5uZWxzXG4gICAgICAgICAgICBmb3IgY2hhbm5lbCBpbiBjb25uZWN0aW9uLmNoYW5uZWxzXG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5zb3VyY2UucHJvdG90eXBlLndoZW5SZWFkeS5jYWxsKGNvbm5lY3Rpb24uc291cmNlLCAoKChkYXRhKSAtPlxuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnNpbmsucHJvdG90eXBlLnB1c2guY2FsbChjb25uZWN0aW9uLnNpbmssIGNoYW5uZWwuaW5sZXQsIGRhdGEpKSksXG4gICAgICAgICAgICAgICAgICAgIGNoYW5uZWwub3V0bGV0KVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBjb25uZWN0aW9uLnNvdXJjZS5wcm90b3R5cGUud2hlblJlYWR5LmNhbGwoY29ubmVjdGlvbi5zb3VyY2UsICgoZGF0YSkgLT5cbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnNpbmsucHVzaChkYXRhKSkpXG5cbiAgICAgICAgaWQudmFsdWUgPSBjb25uZWN0aW9uXG4gICAgICAgIEBjb25uZWN0aW9ucy5pbnRlcm4oaWQpXG5cbiAgICBhZGRTeXN0ZW06IChpZCwgc3lzdGVtQ2xhc3MpIC0+XG4gICAgICAgIHN5c3RlbSA9IG5ldyBzeXN0ZW1DbGFzcyh0aGlzKVxuICAgICAgICBpZC52YWx1ZSA9IHN5c3RlbVxuICAgICAgICBAc3lzdGVtcy5pbnRlcm4oaWQpXG5cbiAgICBzZXJpYWxpemU6IC0+XG4gICAgICAgIHhtbCA9IFwiPHhtbD5cIlxuICAgICAgICB4bWwgKz0gXCI8ZmxvdyBuYW1lPScje0BpZC5uYW1lfSc+XCJcblxuICAgICAgICBmb3Igc3lzdGVtIGluIEBzeXN0ZW1zLmFsbCgpXG4gICAgICAgICAgICB4bWwgKz0gXCI8c3lzdGVtPlwiXG4gICAgICAgICAgICB4bWwgKz0gXCI8L3N5c3RlbT5cIlxuXG4gICAgICAgIGZvciBjb25uZWN0aW9uIGluIEBjb25uZWN0aW9ucy5hbGwoKVxuICAgICAgICAgICAgeG1sICs9IFwiPGNvbm5lY3Rpb24+XCJcbiAgICAgICAgICAgIHhtbCArPSBcIjwvY29ubmVjdGlvbj5cIlxuXG4gICAgICAgIHhtbCA9IFwiPC9mbG93PlwiXG4gICAgICAgIHhtbCA9IFwiPC94bWw+XCJcblxuICAgIGxvZzogKHgpIC0+XG4gICAgICAgIGNvbnNvbGUubG9nKHgpXG5cblxuZXhwb3J0cy5TeW1ib2wgPSBTeW1ib2xcbmV4cG9ydHMuUyA9IFNcbmV4cG9ydHMuVG9rZW4gPSBUb2tlblxuZXhwb3J0cy5UID0gVFxuZXhwb3J0cy5OYW1lU3BhY2UgPSBOYW1lU3BhY2VcbmV4cG9ydHMuU3lzdGVtID0gU3lzdGVtXG5leHBvcnRzLkNoYW5uZWwgPSBDaGFubmVsXG5leHBvcnRzLkNvbm5lY3Rpb24gPSBDb25uZWN0aW9uXG5leHBvcnRzLk1lc3NhZ2UgPSBNZXNzYWdlXG5leHBvcnRzLkVudGl0eSA9IEVudGl0eVxuZXhwb3J0cy5TdGF0ZUJ1cyA9IFN0YXRlQnVzXG5leHBvcnRzLkZsb3cgPSBGbG93XG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==